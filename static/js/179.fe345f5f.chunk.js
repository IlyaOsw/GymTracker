/*! For license information please see 179.fe345f5f.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkgymtracker=self.webpackChunkgymtracker||[]).push([[179],{1210:(t,e,n)=>{n.d(e,{A:()=>c});var r=n(8168),s=n(5043);const i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"}}]},name:"calendar",theme:"outlined"};var o=n(2172),a=function(t,e){return s.createElement(o.A,(0,r.A)({},t,{ref:e,icon:i}))};const c=s.forwardRef(a)},1966:(t,e,n)=>{n.d(e,{A:()=>c});var r=n(8168),s=n(5043);const i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};var o=n(2172),a=function(t,e){return s.createElement(o.A,(0,r.A)({},t,{ref:e,icon:i}))};const c=s.forwardRef(a)},5534:(t,e,n)=>{n.d(e,{A:()=>c});var r=n(8168),s=n(5043);const i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"};var o=n(2172),a=function(t,e){return s.createElement(o.A,(0,r.A)({},t,{ref:e,icon:i}))};const c=s.forwardRef(a)},3183:(t,e,n)=>{n.d(e,{p9:()=>a});var r=n(6647),s=n(955);const i=new r.Mo("antFadeIn",{"0%":{opacity:0},"100%":{opacity:1}}),o=new r.Mo("antFadeOut",{"0%":{opacity:1},"100%":{opacity:0}}),a=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{antCls:n}=t,r="".concat(n,"-fade"),a=e?"&":"";return[(0,s.b)(r,i,o,t.motionDurationMid,e),{["\n        ".concat(a).concat(r,"-enter,\n        ").concat(a).concat(r,"-appear\n      ")]:{opacity:0,animationTimingFunction:"linear"},["".concat(a).concat(r,"-leave")]:{animationTimingFunction:"linear"}}]}},6032:(t,e,n)=>{n.d(e,{H9:()=>Bh,x7:()=>El,aU:()=>zh,BN:()=>_l});var r,s=n(52),i=n(8812),o=n(443),a=n(7700),c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},u={},h=h||{},l=c||self;function d(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function f(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),m=0;function p(t,e,n){return t.call.apply(t.bind,arguments)}function y(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function v(t,e,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?p:y).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function E(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function T(){this.s=this.s,this.o=this.o}T.prototype.s=!1,T.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,g)&&t[g]||(t[g]=++m))},T.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const _=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"===typeof t)return"string"!==typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function b(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function S(t,e){for(let n=1;n<arguments.length;n++){const e=arguments[n];if(d(e)){const n=t.length||0,r=e.length||0;t.length=n+r;for(let s=0;s<r;s++)t[n+s]=e[s]}else t.push(e)}}function C(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}C.prototype.h=function(){this.defaultPrevented=!0};var I=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};l.addEventListener("test",t,e),l.removeEventListener("test",t,e)}catch(n){}return t}();function A(t){return/^[\s\xa0]*$/.test(t)}function D(){var t=l.navigator;return t&&(t=t.userAgent)?t:""}function N(t){return-1!=D().indexOf(t)}function k(t){return k[" "](t),t}k[" "]=function(){};var x,R,L=N("Opera"),O=N("Trident")||N("MSIE"),M=N("Edge"),P=M||O,V=N("Gecko")&&!(-1!=D().toLowerCase().indexOf("webkit")&&!N("Edge"))&&!(N("Trident")||N("MSIE"))&&!N("Edge"),F=-1!=D().toLowerCase().indexOf("webkit")&&!N("Edge");function U(){var t=l.document;return t?t.documentMode:void 0}t:{var B="",j=function(){var t=D();return V?/rv:([^\);]+)(\)|;)/.exec(t):M?/Edge\/([\d\.]+)/.exec(t):O?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):F?/WebKit\/(\S+)/.exec(t):L?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if(j&&(B=j?j[1]:""),O){var q=U();if(null!=q&&q>parseFloat(B)){x=String(q);break t}}x=B}if(l.document&&O){var z=U();R=z||(parseInt(x,10)||void 0)}else R=void 0;var K=R;function G(t,e){if(C.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(V){t:{try{k(e.nodeName);var s=!0;break t}catch(i){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"===typeof t.pointerType?t.pointerType:Q[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&G.$.h.call(this)}}E(G,C);var Q={2:"touch",3:"pen",4:"mouse"};G.prototype.h=function(){G.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var H="closure_listenable_"+(1e6*Math.random()|0),W=0;function X(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=s,this.key=++W,this.fa=this.ia=!1}function Y(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function J(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function $(t){const e={};for(const n in t)e[n]=t[n];return e}const Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t,e){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s],r)t[n]=r[n];for(let e=0;e<Z.length;e++)n=Z[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function et(t){this.src=t,this.g={},this.h=0}function nt(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=_(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(Y(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function rt(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==r)return s}return-1}et.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=rt(t,e,r,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new X(e,this.src,i,!!r,s)).ia=n,t.push(e)),e};var st="closure_lm_"+(1e6*Math.random()|0),it={};function ot(t,e,n,r,s){if(r&&r.once)return ct(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)ot(t,e[i],n,r,s);return null}return n=mt(n),t&&t[H]?t.O(e,n,f(r)?!!r.capture:!!r,s):at(t,e,n,!1,r,s)}function at(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=f(s)?!!s.capture:!!s,a=ft(t);if(a||(t[st]=a=new et(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}const e=dt;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)I||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(lt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ct(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)ct(t,e[i],n,r,s);return null}return n=mt(n),t&&t[H]?t.P(e,n,f(r)?!!r.capture:!!r,s):at(t,e,n,!0,r,s)}function ut(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)ut(t,e[i],n,r,s);else r=f(r)?!!r.capture:!!r,n=mt(n),t&&t[H]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=rt(i=t.g[e],n,r,s))&&(Y(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--)))):t&&(t=ft(t))&&(e=t.g[e.toString()],t=-1,e&&(t=rt(e,n,r,s)),(n=-1<t?e[t]:null)&&ht(n))}function ht(t){if("number"!==typeof t&&t&&!t.fa){var e=t.src;if(e&&e[H])nt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(lt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ft(e))?(nt(n,t),0==n.h&&(n.src=null,e[st]=null)):Y(t)}}}function lt(t){return t in it?it[t]:it[t]="on"+t}function dt(t,e){if(t.fa)t=!0;else{e=new G(e,this);var n=t.listener,r=t.la||t.src;t.ia&&ht(t),t=n.call(r,e)}return t}function ft(t){return(t=t[st])instanceof et?t:null}var gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function mt(t){return"function"===typeof t?t:(t[gt]||(t[gt]=function(e){return t.handleEvent(e)}),t[gt])}function pt(){T.call(this),this.i=new et(this),this.S=this,this.J=null}function yt(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"===typeof e)e=new C(e,t);else if(e instanceof C)e.target=e.target||t;else{var s=e;tt(e=new C(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=vt(o,r,!0,e)&&s}if(s=vt(o=e.g=t,r,!0,e)&&s,s=vt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=vt(o=e.g=n[i],r,!1,e)&&s}function vt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&nt(t.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}E(pt,T),pt.prototype[H]=!0,pt.prototype.removeEventListener=function(t,e,n,r){ut(this,t,e,n,r)},pt.prototype.N=function(){if(pt.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Y(n[r]);delete e.g[t],e.h--}}this.J=null},pt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},pt.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var wt=l.JSON.stringify;function Et(){var t=At;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Tt=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new _t),(t=>t.reset()));class _t{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function bt(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function St(t){l.setTimeout((()=>{throw t}),0)}let Ct,It=!1,At=new class{constructor(){this.h=this.g=null}add(t,e){const n=Tt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Dt=()=>{const t=l.Promise.resolve(void 0);Ct=()=>{t.then(Nt)}};var Nt=()=>{for(var t;t=Et();){try{t.h.call(t.g)}catch(n){St(n)}var e=Tt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}It=!1};function kt(t,e){pt.call(this),this.h=t||1,this.g=e||l,this.j=v(this.qb,this),this.l=Date.now()}function xt(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Rt(t,e,n){if("function"===typeof t)n&&(t=v(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=v(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function Lt(t){t.g=Rt((()=>{t.g=null,t.i&&(t.i=!1,Lt(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}E(kt,pt),(r=kt.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),yt(this,"tick"),this.ga&&(xt(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){kt.$.N.call(this),xt(this),delete this.g};class Ot extends T{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Lt(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mt(t){T.call(this),this.h=t,this.g={}}E(Mt,T);var Pt=[];function Vt(t,e,n,r){Array.isArray(n)||(n&&(Pt[0]=n.toString()),n=Pt);for(var s=0;s<n.length;s++){var i=ot(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function Ft(t){J(t.g,(function(t,e){this.g.hasOwnProperty(e)&&ht(t)}),t),t.g={}}function Ut(){this.g=!0}function Bt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return wt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Mt.prototype.N=function(){Mt.$.N.call(this),Ft(this)},Mt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ut.prototype.Ea=function(){this.g=!1},Ut.prototype.info=function(){};var jt={},qt=null;function zt(){return qt=qt||new pt}function Kt(t){C.call(this,jt.Ta,t)}function Gt(t){const e=zt();yt(e,new Kt(e))}function Qt(t,e){C.call(this,jt.STAT_EVENT,t),this.stat=e}function Ht(t){const e=zt();yt(e,new Qt(e,t))}function Wt(t,e){C.call(this,jt.Ua,t),this.size=e}function Xt(t,e){if("function"!==typeof t)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){t()}),e)}jt.Ta="serverreachability",E(Kt,C),jt.STAT_EVENT="statevent",E(Qt,C),jt.Ua="timingevent",E(Wt,C);var Yt={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Jt={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function $t(){}function Zt(t){return t.h||(t.h=t.i())}function te(){}$t.prototype.h=null;var ee,ne={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function re(){C.call(this,"d")}function se(){C.call(this,"c")}function ie(){}function oe(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Mt(this),this.P=ce,t=P?125:void 0,this.V=new kt(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ae}function ae(){this.i=null,this.g="",this.h=!1}E(re,C),E(se,C),E(ie,$t),ie.prototype.g=function(){return new XMLHttpRequest},ie.prototype.i=function(){return{}},ee=new ie;var ce=45e3,ue={},he={};function le(t,e,n){t.L=1,t.A=ke(Ce(e)),t.u=n,t.S=!0,de(t,null)}function de(t,e){t.G=Date.now(),pe(t),t.B=Ce(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),ze(n.i,"t",r),t.o=0,n=t.l.J,t.h=new ae,t.g=Gn(t.l,n?e:null,!t.u),0<t.O&&(t.M=new Ot(v(t.Pa,t,t.g),t.O)),Vt(t.U,t.g,"readystatechange",t.nb),e=t.I?$(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),Gt(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function fe(t){return!!t.g&&("GET"==t.v&&2!=t.L&&t.l.Ha)}function ge(t,e,n){let r,s=!0;for(;!t.J&&t.o<n.length;){if(r=me(t,n),r==he){4==e&&(t.s=4,Ht(14),s=!1),Bt(t.j,t.m,null,"[Incomplete Response]");break}if(r==ue){t.s=4,Ht(15),Bt(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Bt(t.j,t.m,r,null),Te(t,r)}fe(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,Ht(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Vn(e),e.M=!0,Ht(11))):(Bt(t.j,t.m,n,"[Invalid Chunked Response]"),Ee(t),we(t))}function me(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?he:(n=Number(e.substring(n,r)),isNaN(n)?ue:(r+=1)+n>e.length?he:(e=e.slice(r,r+n),t.o=r+n,e))}function pe(t){t.Y=Date.now()+t.P,ye(t,t.P)}function ye(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=Xt(v(t.lb,t),e)}function ve(t){t.C&&(l.clearTimeout(t.C),t.C=null)}function we(t){0==t.l.H||t.J||Bn(t.l,t)}function Ee(t){ve(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,xt(t.V),Ft(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Te(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Ye(n.i,t)))if(!t.K&&Ye(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Un(n),Nn(n)}Pn(n),Ht(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=Xt(v(n.ib,n),6e3));if(1>=Xe(n.i)&&n.oa){try{n.oa()}catch(u){}n.oa=void 0}}else qn(n,11)}else if((t.K||n.g==t)&&Un(n),!A(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const s=u[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"===typeof h&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.i;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Je(i,i.h),i.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,Ne(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=Kn(r,r.J?r.pa:null,r.Y),o.K){$e(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(ve(a),pe(a)),r.g=o}else Mn(r);0<n.j.length&&xn(n)}else"stop"!=u[0]&&"close"!=u[0]||qn(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?qn(n,7):Dn(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Gt()}catch(u){}}function _e(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||"string"===typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!==typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!==typeof Set&&t instanceof Set)){if(d(t)||"string"===typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!==typeof Map&&t instanceof Map||"undefined"!==typeof Set&&t instanceof Set)return Array.from(t.values());if("string"===typeof t)return t.split("");if(d(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}(r=oe.prototype).setTimeout=function(t){this.P=t},r.nb=function(t){t=t.target;const e=this.M;e&&3==_n(t)?e.l():this.Pa(t)},r.Pa=function(t){try{if(t==this.g)t:{const h=_n(this.g);var e=this.g.Ia();this.g.da();if(!(3>h)&&(3!=h||P||this.g&&(this.h.h||this.g.ja()||bn(this.g)))){this.J||4!=h||7==e||Gt(),ve(this);var n=this.g.da();this.ca=n;e:if(fe(this)){var r=bn(this.g);t="";var s=r.length,i=4==_n(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Ee(this),we(this);var o="";break e}this.h.i=new l.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.v,this.B,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.s=3,Ht(12),Ee(this),we(this);break t}Bt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Te(this,n)}this.S?(ge(this,h,o),P&&this.i&&3==h&&(Vt(this.U,this.V,"tick",this.mb),this.V.start())):(Bt(this.j,this.m,o,null),Te(this,o)),4==h&&Ee(this),this.i&&!this.J&&(4==h?Bn(this.l,this):(this.i=!1,pe(this)))}else(function(t){const e={};t=(t.g&&2<=_n(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(A(t[r]))continue;var n=bt(t[r]);const s=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Ht(12)):(this.s=0,Ht(13)),Ee(this),we(this)}}}catch(h){}},r.mb=function(){if(this.g){var t=_n(this.g),e=this.g.ja();this.o<e.length&&(ve(this),ge(this,t,e),this.i&&4!=t&&pe(this))}},r.cancel=function(){this.J=!0,Ee(this)},r.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(Gt(),Ht(17)),Ee(this),this.s=2,we(this)):ye(this,this.Y-t)};var be=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Se(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Se){this.h=t.h,Ie(this,t.j),this.s=t.s,this.g=t.g,Ae(this,t.m),this.l=t.l;var e=t.i,n=new Ue;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),De(this,n),this.o=t.o}else t&&(e=String(t).match(be))?(this.h=!1,Ie(this,e[1]||"",!0),this.s=xe(e[2]||""),this.g=xe(e[3]||"",!0),Ae(this,e[4]),this.l=xe(e[5]||"",!0),De(this,e[6]||"",!0),this.o=xe(e[7]||"")):(this.h=!1,this.i=new Ue(null,this.h))}function Ce(t){return new Se(t)}function Ie(t,e,n){t.j=n?xe(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ae(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function De(t,e,n){e instanceof Ue?(t.i=e,function(t,e){e&&!t.j&&(Be(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(je(this,e),ze(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Re(e,Ve)),t.i=new Ue(e,t.h))}function Ne(t,e,n){t.i.set(e,n)}function ke(t){return Ne(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function xe(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Re(t,e,n){return"string"===typeof t?(t=encodeURI(t).replace(e,Le),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Le(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Se.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Re(e,Oe,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Re(e,Oe,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Re(n,"/"==n.charAt(0)?Pe:Me,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Re(n,Fe)),t.join("")};var Oe=/[#\/\?@]/g,Me=/[#\?:]/g,Pe=/[#\?]/g,Ve=/[#\?@]/g,Fe=/#/g;function Ue(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Be(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function je(t,e){Be(t),e=Ke(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function qe(t,e){return Be(t),e=Ke(t,e),t.g.has(e)}function ze(t,e,n){je(t,e),0<n.length&&(t.i=null,t.g.set(Ke(t,e),b(n)),t.h+=n.length)}function Ke(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(r=Ue.prototype).add=function(t,e){Be(this),this.i=null,t=Ke(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},r.forEach=function(t,e){Be(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},r.ta=function(){Be(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},r.Z=function(t){Be(this);let e=[];if("string"===typeof t)qe(this,t)&&(e=e.concat(this.g.get(Ke(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},r.set=function(t,e){return Be(this),this.i=null,qe(this,t=Ke(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},r.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")};var Ge=class{constructor(t,e){this.g=t,this.map=e}};function Qe(t){this.l=t||He,l.PerformanceNavigationTiming?t=0<(t=l.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(l.g&&l.g.Ka&&l.g.Ka()&&l.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var He=10;function We(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Xe(t){return t.h?1:t.g?t.g.size:0}function Ye(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Je(t,e){t.g?t.g.add(e):t.h=e}function $e(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Ze(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return b(t.i)}Qe.prototype.cancel=function(){if(this.i=Ze(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var tn,en=class{stringify(t){return l.JSON.stringify(t,void 0)}parse(t){return l.JSON.parse(t,void 0)}};function nn(){this.g=new en}function rn(t,e,n){const r=n||"";try{_e(t,(function(t,n){let s=t;f(t)&&(s=wt(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function sn(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function on(t){this.l=t.ec||null,this.j=t.ob||!1}function an(t,e){pt.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=cn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}E(on,$t),on.prototype.g=function(){return new an(this.l,this.j)},on.prototype.i=(tn={},function(){return tn}),E(an,pt);var cn=0;function un(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function hn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,ln(t)}function ln(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(r=an.prototype).open=function(t,e){if(this.readyState!=cn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,ln(this)},r.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||l).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,hn(this)),this.readyState=cn},r.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ln(this)),this.g&&(this.readyState=3,ln(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if("undefined"!==typeof l.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;un(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?hn(this):ln(this),3==this.readyState&&un(this)}},r.Za=function(t){this.g&&(this.response=this.responseText=t,hn(this))},r.Ya=function(t){this.g&&(this.response=t,hn(this))},r.ka=function(){this.g&&hn(this)},r.setRequestHeader=function(t,e){this.v.append(t,e)},r.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(an.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var dn=l.JSON.parse;function fn(t){pt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=gn,this.L=this.M=!1}E(fn,pt);var gn="",mn=/^https?$/i,pn=["POST","PUT"];function yn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,vn(t),En(t)}function vn(t){t.F||(t.F=!0,yt(t,"complete"),yt(t,"error"))}function wn(t){if(t.h&&"undefined"!=typeof h&&(!t.C[1]||4!=_n(t)||2!=t.da()))if(t.v&&4==_n(t))Rt(t.La,0,t);else if(yt(t,"readystatechange"),4==_n(t)){t.h=!1;try{const a=t.da();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===a){var s=String(t.I).match(be)[1]||null;!s&&l.self&&l.self.location&&(s=l.self.location.protocol.slice(0,-1)),r=!mn.test(s?s.toLowerCase():"")}n=r}if(n)yt(t,"complete"),yt(t,"success");else{t.m=6;try{var i=2<_n(t)?t.g.statusText:""}catch(o){i=""}t.j=i+" ["+t.da()+"]",vn(t)}}finally{En(t)}}}function En(t,e){if(t.g){Tn(t);const r=t.g,s=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||yt(t,"ready");try{r.onreadystatechange=s}catch(n){}}}function Tn(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(l.clearTimeout(t.A),t.A=null)}function _n(t){return t.g?t.g.readyState:0}function bn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case gn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(kr){return null}}function Sn(t){let e="";return J(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Cn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Sn(n),"string"===typeof t?null!=n&&encodeURIComponent(String(n)):Ne(t,e,n))}function In(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function An(t){this.Ga=0,this.j=[],this.l=new Ut,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=In("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=In("baseRetryDelayMs",5e3,t),this.hb=In("retryDelaySeedMs",1e4,t),this.eb=In("forwardChannelMaxRetries",2,t),this.xa=In("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Qe(t&&t.concurrentRequestLimit),this.Ja=new nn,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Dn(t){if(kn(t),3==t.H){var e=t.W++,n=Ce(t.I);if(Ne(n,"SID",t.K),Ne(n,"RID",e),Ne(n,"TYPE","terminate"),Ln(t,n),(e=new oe(t,t.l,e)).L=2,e.A=ke(Ce(n)),n=!1,l.navigator&&l.navigator.sendBeacon)try{n=l.navigator.sendBeacon(e.A.toString(),"")}catch(r){}!n&&l.Image&&((new Image).src=e.A,n=!0),n||(e.g=Gn(e.l,null),e.g.ha(e.A)),e.G=Date.now(),pe(e)}zn(t)}function Nn(t){t.g&&(Vn(t),t.g.cancel(),t.g=null)}function kn(t){Nn(t),t.u&&(l.clearTimeout(t.u),t.u=null),Un(t),t.i.cancel(),t.m&&("number"===typeof t.m&&l.clearTimeout(t.m),t.m=null)}function xn(t){if(!We(t.i)&&!t.m){t.m=!0;var e=t.Na;Ct||Dt(),It||(Ct(),It=!0),At.add(e,t),t.C=0}}function Rn(t,e){var n;n=e?e.m:t.W++;const r=Ce(t.I);Ne(r,"SID",t.K),Ne(r,"RID",n),Ne(r,"AID",t.V),Ln(t,r),t.o&&t.s&&Cn(r,t.o,t.s),n=new oe(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=On(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Je(t.i,n),le(n,r,e)}function Ln(t,e){t.na&&J(t.na,(function(t,n){Ne(e,n,t)})),t.h&&_e({},(function(t,n){Ne(e,n,t)}))}function On(t,e,n){n=Math.min(t.j.length,n);var r=t.h?v(t.h.Va,t.h,t):null;t:{var s=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let o=!0;for(let a=0;a<n;a++){let n=s[a].g;const c=s[a].map;if(n-=e,0>n)e=Math.max(0,s[a].g-100),o=!1;else try{rn(c,t,"req"+n+"_")}catch(i){r&&r(c)}}if(o){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function Mn(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Ct||Dt(),It||(Ct(),It=!0),At.add(e,t),t.A=0}}function Pn(t){return!(t.g||t.u||3<=t.A)&&(t.ba++,t.u=Xt(v(t.Ma,t),jn(t,t.A)),t.A++,!0)}function Vn(t){null!=t.B&&(l.clearTimeout(t.B),t.B=null)}function Fn(t){t.g=new oe(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Ce(t.wa);Ne(e,"RID","rpc"),Ne(e,"SID",t.K),Ne(e,"AID",t.V),Ne(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Ne(e,"TO",t.qa),Ne(e,"TYPE","xmlhttp"),Ln(t,e),t.o&&t.s&&Cn(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=ke(Ce(e)),n.u=null,n.S=!0,de(n,t)}function Un(t){null!=t.v&&(l.clearTimeout(t.v),t.v=null)}function Bn(t,e){var n=null;if(t.g==e){Un(t),Vn(t),t.g=null;var r=2}else{if(!Ye(t.i,e))return;n=e.F,$e(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var s=t.C;yt(r=zt(),new Wt(r,n)),xn(t)}else Mn(t);else if(3==(s=e.s)||0==s&&0<e.ca||!(1==r&&function(t,e){return!(Xe(t.i)>=t.i.j-(t.m?1:0))&&(t.m?(t.j=e.F.concat(t.j),!0):!(1==t.H||2==t.H||t.C>=(t.cb?0:t.eb))&&(t.m=Xt(v(t.Na,t,e),jn(t,t.C)),t.C++,!0))}(t,e)||2==r&&Pn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:qn(t,5);break;case 4:qn(t,10);break;case 3:qn(t,6);break;default:qn(t,2)}}function jn(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function qn(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=v(t.pb,t);n||(n=new Se("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Ie(n,"https"),ke(n)),function(t,e){const n=new Ut;if(l.Image){const r=new Image;r.onload=w(sn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=w(sn,n,r,"TestLoadImage: error",!1,e),r.onabort=w(sn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=w(sn,n,r,"TestLoadImage: timeout",!1,e),l.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Ht(2);t.H=0,t.h&&t.h.za(e),zn(t),kn(t)}function zn(t){if(t.H=0,t.ma=[],t.h){const e=Ze(t.i);0==e.length&&0==t.j.length||(S(t.ma,e),S(t.ma,t.j),t.i.i.length=0,b(t.j),t.j.length=0),t.h.ya()}}function Kn(t,e,n){var r=n instanceof Se?Ce(n):new Se(n);if(""!=r.g)e&&(r.g=e+"."+r.g),Ae(r,r.m);else{var s=l.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new Se(null);r&&Ie(i,r),e&&(i.g=e),s&&Ae(i,s),n&&(i.l=n),r=i}return n=t.F,e=t.Da,n&&e&&Ne(r,n,e),Ne(r,"VER",t.ra),Ln(t,r),r}function Gn(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new fn(new on({ob:n})):new fn(t.va)).Oa(t.J),e}function Qn(){}function Hn(){if(O&&!(10<=Number(K)))throw Error("Environmental error: no available transport.")}function Wn(t,e){pt.call(this),this.g=new An(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!A(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!A(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Jn(this)}function Xn(t){re.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Yn(){se.call(this),this.status=1}function Jn(t){this.g=t}function $n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Zn(t,e,n){n||(n=0);var r=Array(16);if("string"===typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var i=t.g[3],o=e+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+i&4294967295}function tr(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}(r=fn.prototype).Oa=function(t){this.M=t},r.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ee.g(),this.C=this.u?Zt(this.u):Zt(ee),this.g.onreadystatechange=v(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(i){return void yn(this,i)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=l.FormData&&t instanceof l.FormData,!(0<=_(pn,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[o,a]of n)this.g.setRequestHeader(o,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Tn(this),0<this.B&&((this.L=function(t){return O&&"number"===typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=v(this.ua,this)):this.A=Rt(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(i){yn(this,i)}},r.ua=function(){"undefined"!=typeof h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,yt(this,"timeout"),this.abort(8))},r.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,yt(this,"complete"),yt(this,"abort"),En(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),En(this,!0)),fn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?wn(this):this.kb())},r.kb=function(){wn(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<_n(this)?this.g.status:-1}catch(tn){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(tn){return""}},r.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dn(e)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=An.prototype).ra=8,r.H=1,r.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new oe(this,this.l,t);let i=this.s;if(this.U&&(i?(i=$(i),tt(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=On(this,s,e),Ne(n=Ce(this.I),"RID",t),Ne(n,"CVER",22),this.F&&Ne(n,"X-HTTP-Session-Id",this.F),Ln(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(Sn(i)))+"&"+e:this.o&&Cn(n,this.o,i)),Je(this.i,s),this.bb&&Ne(n,"TYPE","init"),this.P?(Ne(n,"$req",e),Ne(n,"SID","null"),s.aa=!0,le(s,n,null)):le(s,n,e),this.H=2}}else 3==this.H&&(t?Rn(this,t):0==this.j.length||We(this.i)||Rn(this))},r.Ma=function(){if(this.u=null,Fn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Xt(v(this.jb,this),t)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ht(10),Nn(this),Fn(this))},r.ib=function(){null!=this.v&&(this.v=null,Nn(this),Pn(this),Ht(19))},r.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Ht(2)):(this.l.info("Failed to ping google.com"),Ht(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=Qn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},Hn.prototype.g=function(t,e){return new Wn(t,e)},E(Wn,pt),Wn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Ht(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Kn(t,null,t.Y),xn(t)},Wn.prototype.close=function(){Dn(this.g)},Wn.prototype.u=function(t){var e=this.g;if("string"===typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=wt(t),t=n);e.j.push(new Ge(e.fb++,t)),3==e.H&&xn(e)},Wn.prototype.N=function(){this.g.h=null,delete this.j,Dn(this.g),delete this.g,Wn.$.N.call(this)},E(Xn,re),E(Yn,se),E(Jn,Qn),Jn.prototype.Ba=function(){yt(this.g,"a")},Jn.prototype.Aa=function(t){yt(this.g,new Xn(t))},Jn.prototype.za=function(t){yt(this.g,new Yn)},Jn.prototype.ya=function(){yt(this.g,"b")},E($n,(function(){this.blockSize=-1})),$n.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},$n.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,s=this.h,i=0;i<e;){if(0==s)for(;i<=n;)Zn(this,t,i),i+=this.blockSize;if("string"===typeof t){for(;i<e;)if(r[s++]=t.charCodeAt(i++),s==this.blockSize){Zn(this,r),s=0;break}}else for(;i<e;)if(r[s++]=t[i++],s==this.blockSize){Zn(this,r),s=0;break}}this.h=s,this.i+=e},$n.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var er={};function nr(t){return-128<=t&&128>t?function(t,e){var n=er;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(t){return new tr([0|t],0>t?-1:0)})):new tr([0|t],0>t?-1:0)}function rr(t){if(isNaN(t)||!isFinite(t))return ir;if(0>t)return hr(rr(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=sr;return new tr(e,0)}var sr=4294967296,ir=nr(0),or=nr(1),ar=nr(16777216);function cr(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function ur(t){return-1==t.h}function hr(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new tr(n,~t.h).add(or)}function lr(t,e){return t.add(hr(e))}function dr(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function fr(t,e){this.g=t,this.h=e}function gr(t,e){if(cr(e))throw Error("division by zero");if(cr(t))return new fr(ir,ir);if(ur(t))return e=gr(hr(t),e),new fr(hr(e.g),hr(e.h));if(ur(e))return e=gr(t,hr(e)),new fr(hr(e.g),e.h);if(30<t.g.length){if(ur(t)||ur(e))throw Error("slowDivide_ only works with positive integers.");for(var n=or,r=e;0>=r.X(t);)n=mr(n),r=mr(r);var s=pr(n,1),i=pr(r,1);for(r=pr(r,2),n=pr(n,2);!cr(r);){var o=i.add(r);0>=o.X(t)&&(s=s.add(n),i=o),r=pr(r,1),n=pr(n,1)}return e=lr(t,s.R(e)),new fr(s,e)}for(s=ir;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=rr(n)).R(e);ur(o)||0<o.X(t);)o=(i=rr(n-=r)).R(e);cr(i)&&(i=or),s=s.add(i),t=lr(t,o)}return new fr(s,t)}function mr(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new tr(n,t.h)}function pr(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,s=[],i=0;i<r;i++)s[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new tr(s,t.h)}(r=tr.prototype).ea=function(){if(ur(this))return-hr(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:sr+r)*e,e*=sr}return t},r.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(cr(this))return"0";if(ur(this))return"-"+hr(this).toString(t);for(var e=rr(Math.pow(t,6)),n=this,r="";;){var s=gr(n,e).g,i=((0<(n=lr(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(cr(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},r.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},r.X=function(t){return ur(t=lr(this,t))?-1:cr(t)?0:1},r.abs=function(){return ur(this)?hr(this):this},r.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,s=0;s<=e;s++){var i=r+(65535&this.D(s))+(65535&t.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new tr(n,-2147483648&n[n.length-1]?-1:0)},r.R=function(t){if(cr(this)||cr(t))return ir;if(ur(this))return ur(t)?hr(this).R(hr(t)):hr(hr(this).R(t));if(ur(t))return hr(this.R(hr(t)));if(0>this.X(ar)&&0>t.X(ar))return rr(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<t.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=t.D(s)>>>16,c=65535&t.D(s);n[2*r+2*s]+=o*c,dr(n,2*r+2*s),n[2*r+2*s+1]+=i*c,dr(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,dr(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,dr(n,2*r+2*s+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new tr(n,0)},r.gb=function(t){return gr(this,t).h},r.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new tr(n,this.h&t.h)},r.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new tr(n,this.h|t.h)},r.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new tr(n,this.h^t.h)},Hn.prototype.createWebChannel=Hn.prototype.g,Wn.prototype.send=Wn.prototype.u,Wn.prototype.open=Wn.prototype.m,Wn.prototype.close=Wn.prototype.close,Yt.NO_ERROR=0,Yt.TIMEOUT=8,Yt.HTTP_ERROR=6,Jt.COMPLETE="complete",te.EventType=ne,ne.OPEN="a",ne.CLOSE="b",ne.ERROR="c",ne.MESSAGE="d",pt.prototype.listen=pt.prototype.O,fn.prototype.listenOnce=fn.prototype.P,fn.prototype.getLastError=fn.prototype.Sa,fn.prototype.getLastErrorCode=fn.prototype.Ia,fn.prototype.getStatus=fn.prototype.da,fn.prototype.getResponseJson=fn.prototype.Wa,fn.prototype.getResponseText=fn.prototype.ja,fn.prototype.send=fn.prototype.ha,fn.prototype.setWithCredentials=fn.prototype.Oa,$n.prototype.digest=$n.prototype.l,$n.prototype.reset=$n.prototype.reset,$n.prototype.update=$n.prototype.j,tr.prototype.add=tr.prototype.add,tr.prototype.multiply=tr.prototype.R,tr.prototype.modulo=tr.prototype.gb,tr.prototype.compare=tr.prototype.X,tr.prototype.toNumber=tr.prototype.ea,tr.prototype.toString=tr.prototype.toString,tr.prototype.getBits=tr.prototype.D,tr.fromNumber=rr,tr.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return hr(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=rr(Math.pow(n,8)),s=ir,i=0;i<e.length;i+=8){var o=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+o),n);8>o?(o=rr(Math.pow(n,o)),s=s.R(o).add(rr(a))):s=(s=s.R(r)).add(rr(a))}return s};var yr=u.createWebChannelTransport=function(){return new Hn},vr=u.getStatEventTarget=function(){return zt()},wr=u.ErrorCode=Yt,Er=u.EventType=Jt,Tr=u.Event=jt,_r=u.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},br=(u.FetchXmlHttpFactory=on,u.WebChannel=te),Sr=u.XhrIo=fn,Cr=u.Md5=$n,Ir=u.Integer=tr;const Ar="@firebase/firestore";class Dr{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Dr.UNAUTHENTICATED=new Dr(null),Dr.GOOGLE_CREDENTIALS=new Dr("google-credentials-uid"),Dr.FIRST_PARTY=new Dr("first-party-uid"),Dr.MOCK_USER=new Dr("mock-user");let Nr="10.11.0";const kr=new o.Vy("@firebase/firestore");function xr(){return kr.logLevel}function Rr(t){if(kr.logLevel<=o.$b.DEBUG){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const s=n.map(Mr);kr.debug("Firestore (".concat(Nr,"): ").concat(t),...s)}}function Lr(t){if(kr.logLevel<=o.$b.ERROR){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const s=n.map(Mr);kr.error("Firestore (".concat(Nr,"): ").concat(t),...s)}}function Or(t){if(kr.logLevel<=o.$b.WARN){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const s=n.map(Mr);kr.warn("Firestore (".concat(Nr,"): ").concat(t),...s)}}function Mr(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Pr(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const e="FIRESTORE (".concat(Nr,") INTERNAL ASSERTION FAILED: ")+t;throw Lr(e),new Error(e)}function Vr(t,e){t||Pr()}function Fr(t,e){return t}const Ur={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Br extends a.g{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class jr{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class qr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))}}class zr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Dr.UNAUTHENTICATED)))}shutdown(){}}class Kr{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Gr{constructor(t){this.t=t,this.currentUser=Dr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new jr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new jr,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Rr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Rr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new jr)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Rr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Vr("string"==typeof e.accessToken),new qr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Vr(null===t||"string"==typeof t),new Dr(t)}}class Qr{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Dr.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Hr{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Qr(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Dr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Wr{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Xr{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Rr("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(t.error.message));const n=t.token!==this.R;return this.R=t.token,Rr("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{Rr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):Rr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Vr("string"==typeof t.token),this.R=t.token,new Wr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Yr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class Jr{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=Yr(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%62))}return n}}function $r(t,e){return t<e?-1:t>e?1:0}function Zr(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class ts{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ts.fromMillis(Date.now())}static fromDate(t){return ts.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new ts(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?$r(this.nanoseconds,t.nanoseconds):$r(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class es{constructor(t){this.timestamp=t}static fromTimestamp(t){return new es(t)}static min(){return new es(new ts(0,0))}static max(){return new es(new ts(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ns{constructor(t,e,n){void 0===e?e=0:e>t.length&&Pr(),void 0===n?n=t.length-e:n>t.length-e&&Pr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ns.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ns?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class rs extends ns{construct(t,e,n){return new rs(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const t=[];for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const s of n){if(s.indexOf("//")>=0)throw new Br(Ur.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));t.push(...s.split("/").filter((t=>t.length>0)))}return new rs(t)}static emptyPath(){return new rs([])}}const ss=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class is extends ns{construct(t,e,n){return new is(t,e,n)}static isValidIdentifier(t){return ss.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),is.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new is(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Br(Ur.INVALID_ARGUMENT,"Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Br(Ur.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Br(Ur.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new Br(Ur.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new is(e)}static emptyPath(){return new is([])}}class os{constructor(t){this.path=t}static fromPath(t){return new os(rs.fromString(t))}static fromName(t){return new os(rs.fromString(t).popFirst(5))}static empty(){return new os(rs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===rs.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return rs.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new os(new rs(t.slice()))}}class as{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}as.UNKNOWN_ID=-1;function cs(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=es.fromTimestamp(1e9===r?new ts(n+1,0):new ts(n,r));return new hs(s,os.empty(),e)}function us(t){return new hs(t.readTime,t.key,-1)}class hs{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new hs(es.min(),os.empty(),-1)}static max(){return new hs(es.max(),os.empty(),-1)}}function ls(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=os.comparator(t.documentKey,e.documentKey),0!==n?n:$r(t.largestBatchId,e.largestBatchId))}const ds="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fs{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function gs(t){if(t.code!==Ur.FAILED_PRECONDITION||t.message!==ds)throw t;Rr("LocalStore","Unexpectedly lost primary lease")}class ms{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Pr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new ms(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof ms?e:ms.resolve(e)}catch(t){return ms.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):ms.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):ms.reject(e)}static resolve(t){return new ms(((e,n)=>{e(t)}))}static reject(t){return new ms(((e,n)=>{n(t)}))}static waitFor(t){return new ms(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=ms.resolve(!1);for(const n of t)e=e.next((t=>t?ms.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new ms(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new ms(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}class ps{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new jr,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new ws(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=Ss(e.target.error);this.V.reject(new ws(t,n))}}static open(t,e,n,r){try{return new ps(e,t.transaction(r,n))}catch(t){throw new ws(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(Rr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Ts(e)}}class ys{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===ys.S((0,a.ZQ)())&&Lr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Rr("SimpleDb","Removing database:",t),_s(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!(0,a.zW)())return!1;if(ys.C())return!0;const t=(0,a.ZQ)(),e=ys.S(t),n=0<e&&e<10,r=ys.v(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(Rr("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new ws(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Br(Ur.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Br(Ur.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new ws(t,r))},r.onupgradeneeded=t=>{Rr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,r.transaction,t.oldVersion,this.version).next((()=>{Rr("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=t=>this.L(t)),this.db}B(t){this.L=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.O(t);const e=ps.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),ms.reject(t)))).toPromise();return i.catch((()=>{})),await e.m,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(Rr("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class vs{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return _s(this.k.delete())}}class ws extends Br{constructor(t,e){super(Ur.UNAVAILABLE,"IndexedDB transaction '".concat(t,"' failed: ").concat(e)),this.name="IndexedDbTransactionError"}}function Es(t){return"IndexedDbTransactionError"===t.name}class Ts{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Rr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Rr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),_s(n)}add(t){return Rr("SimpleDb","ADD",this.store.name,t,t),_s(this.store.add(t))}get(t){return _s(this.store.get(t)).next((e=>(void 0===e&&(e=null),Rr("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return Rr("SimpleDb","DELETE",this.store.name,t),_s(this.store.delete(t))}count(){return Rr("SimpleDb","COUNT",this.store.name),_s(this.store.count())}W(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new ms(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new ms(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){Rr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Z(t){const e=this.cursor({});return new ms(((n,r)=>{e.onerror=t=>{const e=Ss(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new ms(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new vs(s),o=e(s.primaryKey,s.value,i);if(o instanceof ms){const t=o.catch((t=>(i.done(),ms.reject(t))));n.push(t)}i.isDone?r():null===i.$?s.continue():s.continue(i.$)}})).next((()=>ms.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function _s(t){return new ms(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Ss(t.target.error);n(e)}}))}let bs=!1;function Ss(t){const e=ys.S((0,a.ZQ)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Br("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(e,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return bs||(bs=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Cs{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function Is(t){return null==t}function As(t){return 0===t&&1/t==-1/0}function Ds(t){return"number"==typeof t&&Number.isInteger(t)&&!As(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}Cs._e=-1;const Ns=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ks=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],xs=ks;function Rs(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ls(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Os(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Ms{constructor(t,e){this.comparator=t,this.root=e||Vs.EMPTY}insert(t,e){return new Ms(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Vs.BLACK,null,null))}remove(t){return new Ms(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Vs.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push("".concat(e,":").concat(n)),!1))),"{".concat(t.join(", "),"}")}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ps(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ps(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ps(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ps(this.root,t,this.comparator,!0)}}class Ps{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Vs{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:Vs.RED,this.left=null!=r?r:Vs.EMPTY,this.right=null!=s?s:Vs.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new Vs(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Vs.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Vs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Vs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Vs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Pr();if(this.right.isRed())throw Pr();const t=this.left.check();if(t!==this.right.check())throw Pr();return t+(this.isRed()?0:1)}}Vs.EMPTY=null,Vs.RED=!0,Vs.BLACK=!1,Vs.EMPTY=new class{constructor(){this.size=0}get key(){throw Pr()}get value(){throw Pr()}get color(){throw Pr()}get left(){throw Pr()}get right(){throw Pr()}copy(t,e,n,r,s){return this}insert(t,e,n){return new Vs(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Fs{constructor(t){this.comparator=t,this.data=new Ms(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Us(this.data.getIterator())}getIteratorFrom(t){return new Us(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Fs))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Fs(this.comparator);return e.data=t,e}}class Us{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Bs{constructor(t){this.fields=t,t.sort(is.comparator)}static empty(){return new Bs([])}unionWith(t){let e=new Fs(is.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new Bs(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Zr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class js extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class qs{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new js("Invalid base64 string: "+t):t}}(t);return new qs(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new qs(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return $r(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}qs.EMPTY_BYTE_STRING=new qs("");const zs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ks(t){if(Vr(!!t),"string"==typeof t){let e=0;const n=zs.exec(t);if(Vr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Gs(t.seconds),nanos:Gs(t.nanos)}}function Gs(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Qs(t){return"string"==typeof t?qs.fromBase64String(t):qs.fromUint8Array(t)}function Hs(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ws(t){const e=t.mapValue.fields.__previous_value__;return Hs(e)?Ws(e):e}function Xs(t){const e=Ks(t.mapValue.fields.__local_write_time__.timestampValue);return new ts(e.seconds,e.nanos)}class Ys{constructor(t,e,n,r,s,i,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Js{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Js("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Js&&t.projectId===this.projectId&&t.database===this.database}}const $s={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Zs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Hs(t)?4:di(t)?9007199254740991:10:Pr()}function ti(t,e){if(t===e)return!0;const n=Zs(t);if(n!==Zs(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Xs(t).isEqual(Xs(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Ks(t.timestampValue),r=Ks(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Qs(t.bytesValue).isEqual(Qs(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Gs(t.geoPointValue.latitude)===Gs(e.geoPointValue.latitude)&&Gs(t.geoPointValue.longitude)===Gs(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Gs(t.integerValue)===Gs(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Gs(t.doubleValue),r=Gs(e.doubleValue);return n===r?As(n)===As(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Zr(t.arrayValue.values||[],e.arrayValue.values||[],ti);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Rs(n)!==Rs(r))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===r[s]||!ti(n[s],r[s])))return!1;return!0}(t,e);default:return Pr()}}function ei(t,e){return void 0!==(t.values||[]).find((t=>ti(t,e)))}function ni(t,e){if(t===e)return 0;const n=Zs(t),r=Zs(e);if(n!==r)return $r(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return $r(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Gs(t.integerValue||t.doubleValue),r=Gs(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ri(t.timestampValue,e.timestampValue);case 4:return ri(Xs(t),Xs(e));case 5:return $r(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Qs(t),r=Qs(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let s=0;s<n.length&&s<r.length;s++){const t=$r(n[s],r[s]);if(0!==t)return t}return $r(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=$r(Gs(t.latitude),Gs(e.latitude));return 0!==n?n:$r(Gs(t.longitude),Gs(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const t=ni(n[s],r[s]);if(t)return t}return $r(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===$s.mapValue&&e===$s.mapValue)return 0;if(t===$s.mapValue)return 1;if(e===$s.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let o=0;o<r.length&&o<i.length;++o){const t=$r(r[o],i[o]);if(0!==t)return t;const e=ni(n[r[o]],s[i[o]]);if(0!==e)return e}return $r(r.length,i.length)}(t.mapValue,e.mapValue);default:throw Pr()}}function ri(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return $r(t,e);const n=Ks(t),r=Ks(e),s=$r(n.seconds,r.seconds);return 0!==s?s:$r(n.nanos,r.nanos)}function si(t){return ii(t)}function ii(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Ks(t);return"time(".concat(e.seconds,",").concat(e.nanos,")")}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Qs(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return os.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return"geo(".concat(t.latitude,",").concat(t.longitude,")")}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=ii(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+="".concat(s,":").concat(ii(t.fields[s]));return n+"}"}(t.mapValue):Pr()}function oi(t){return!!t&&"integerValue"in t}function ai(t){return!!t&&"arrayValue"in t}function ci(t){return!!t&&"nullValue"in t}function ui(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function hi(t){return!!t&&"mapValue"in t}function li(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ls(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=li(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=li(t.arrayValue.values[n]);return e}return Object.assign({},t)}function di(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class fi{constructor(t){this.value=t}static empty(){return new fi({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!hi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=li(e)}setAll(t){let e=is.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=li(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());hi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ti(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];hi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Ls(e,((e,n)=>t[e]=n));for(const r of n)delete t[r]}clone(){return new fi(li(this.value))}}function gi(t){const e=[];return Ls(t.fields,((t,n)=>{const r=new is([t]);if(hi(n)){const t=gi(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new Bs(e)}class mi{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new mi(t,0,es.min(),es.min(),es.min(),fi.empty(),0)}static newFoundDocument(t,e,n,r){return new mi(t,1,e,es.min(),n,r,0)}static newNoDocument(t,e){return new mi(t,2,e,es.min(),es.min(),fi.empty(),0)}static newUnknownDocument(t,e){return new mi(t,3,e,es.min(),es.min(),fi.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(es.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=fi.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=fi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=es.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof mi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new mi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class pi{constructor(t,e){this.position=t,this.inclusive=e}}function yi(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?os.comparator(os.fromName(o.referenceValue),n.key):ni(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function vi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ti(t.position[n],e.position[n]))return!1;return!0}class wi{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=t,this.dir=e}}function Ei(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Ti{}class _i extends Ti{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new ki(t,e,n):"array-contains"===e?new Oi(t,n):"in"===e?new Mi(t,n):"not-in"===e?new Pi(t,n):"array-contains-any"===e?new Vi(t,n):new _i(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new xi(t,n):new Ri(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(ni(e,this.value)):null!==e&&Zs(this.value)===Zs(e)&&this.matchesComparison(ni(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Pr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class bi extends Ti{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new bi(t,e)}matches(t){return Si(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Si(t){return"and"===t.op}function Ci(t){return Ii(t)&&Si(t)}function Ii(t){for(const e of t.filters)if(e instanceof bi)return!1;return!0}function Ai(t){if(t instanceof _i)return t.field.canonicalString()+t.op.toString()+si(t.value);if(Ci(t))return t.filters.map((t=>Ai(t))).join(",");{const e=t.filters.map((t=>Ai(t))).join(",");return"".concat(t.op,"(").concat(e,")")}}function Di(t,e){return t instanceof _i?function(t,e){return e instanceof _i&&t.op===e.op&&t.field.isEqual(e.field)&&ti(t.value,e.value)}(t,e):t instanceof bi?function(t,e){return e instanceof bi&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&Di(n,e.filters[r])),!0)}(t,e):void Pr()}function Ni(t){return t instanceof _i?function(t){return"".concat(t.field.canonicalString()," ").concat(t.op," ").concat(si(t.value))}(t):t instanceof bi?function(t){return t.op.toString()+" {"+t.getFilters().map(Ni).join(" ,")+"}"}(t):"Filter"}class ki extends _i{constructor(t,e,n){super(t,e,n),this.key=os.fromName(n.referenceValue)}matches(t){const e=os.comparator(t.key,this.key);return this.matchesComparison(e)}}class xi extends _i{constructor(t,e){super(t,"in",e),this.keys=Li("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ri extends _i{constructor(t,e){super(t,"not-in",e),this.keys=Li("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Li(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>os.fromName(t.referenceValue)))}class Oi extends _i{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ai(e)&&ei(e.arrayValue,this.value)}}class Mi extends _i{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&ei(this.value.arrayValue,e)}}class Pi extends _i{constructor(t,e){super(t,"not-in",e)}matches(t){if(ei(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!ei(this.value.arrayValue,e)}}class Vi extends _i{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ai(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>ei(this.value.arrayValue,t)))}}class Fi{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ce=null}}function Ui(t){return new Fi(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Bi(t){const e=Fr(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Ai(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Is(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>si(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>si(t))).join(",")),e.ce=t}return e.ce}function ji(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Ei(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Di(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!vi(t.startAt,e.startAt)&&vi(t.endAt,e.endAt)}function qi(t){return os.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class zi{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Ki(t,e,n,r,s,i,o,a){return new zi(t,e,n,r,s,i,o,a)}function Gi(t){return new zi(t)}function Qi(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Hi(t){return null!==t.collectionGroup}function Wi(t){const e=Fr(t);if(null===e.le){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Fs(is.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new wi(r,n))})),t.has(is.keyField().canonicalString())||e.le.push(new wi(is.keyField(),n))}return e.le}function Xi(t){const e=Fr(t);return e.he||(e.he=Yi(e,Wi(t))),e.he}function Yi(t,e){if("F"===t.limitType)return Ui(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new wi(t.field,e)}));const n=t.endAt?new pi(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new pi(t.startAt.position,t.startAt.inclusive):null;return Ui(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Ji(t,e,n){return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function $i(t,e){return ji(Xi(t),Xi(e))&&t.limitType===e.limitType}function Zi(t){return"".concat(Bi(Xi(t)),"|lt:").concat(t.limitType)}function to(t){return"Query(target=".concat(function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: [".concat(t.filters.map((t=>Ni(t))).join(", "),"]")),Is(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: [".concat(t.orderBy.map((t=>function(t){return"".concat(t.field.canonicalString()," (").concat(t.dir,")")}(t))).join(", "),"]")),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>si(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>si(t))).join(",")),"Target(".concat(e,")")}(Xi(t)),"; limitType=").concat(t.limitType,")")}function eo(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):os.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Wi(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=yi(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Wi(t),e))&&!(t.endAt&&!function(t,e,n){const r=yi(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Wi(t),e))}(t,e)}function no(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function ro(t){return(e,n)=>{let r=!1;for(const s of Wi(t)){const t=so(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function so(t,e,n){const r=t.field.isKeyField()?os.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?ni(r,s):Pr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Pr()}}class io{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[r,s]of n)if(this.equalsFn(r,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return void(r[s]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Ls(this.inner,((e,n)=>{for(const[r,s]of n)t(r,s)}))}isEmpty(){return Os(this.inner)}size(){return this.innerSize}}const oo=new Ms(os.comparator);function ao(){return oo}const co=new Ms(os.comparator);function uo(){let t=co;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const s of n)t=t.insert(s.key,s);return t}function ho(t){let e=co;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function lo(){return go()}function fo(){return go()}function go(){return new io((t=>t.toString()),((t,e)=>t.isEqual(e)))}const mo=new Ms(os.comparator),po=new Fs(os.comparator);function yo(){let t=po;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const s of n)t=t.add(s);return t}const vo=new Fs($r);function wo(){return vo}function Eo(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:As(e)?"-0":e}}function To(t){return{integerValue:""+t}}function _o(t,e){return Ds(e)?To(e):Eo(t,e)}class bo{constructor(){this._=void 0}}function So(t,e,n){return t instanceof Ao?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Hs(e)&&(e=Ws(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Do?No(t,e):t instanceof ko?xo(t,e):function(t,e){const n=Io(t,e),r=Lo(n)+Lo(t.Ie);return oi(n)&&oi(t.Ie)?To(r):Eo(t.serializer,r)}(t,e)}function Co(t,e,n){return t instanceof Do?No(t,e):t instanceof ko?xo(t,e):n}function Io(t,e){return t instanceof Ro?function(t){return oi(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Ao extends bo{}class Do extends bo{constructor(t){super(),this.elements=t}}function No(t,e){const n=Oo(e);for(const r of t.elements)n.some((t=>ti(t,r)))||n.push(r);return{arrayValue:{values:n}}}class ko extends bo{constructor(t){super(),this.elements=t}}function xo(t,e){let n=Oo(e);for(const r of t.elements)n=n.filter((t=>!ti(t,r)));return{arrayValue:{values:n}}}class Ro extends bo{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function Lo(t){return Gs(t.integerValue||t.doubleValue)}function Oo(t){return ai(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Mo{constructor(t,e){this.version=t,this.transformResults=e}}class Po{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Po}static exists(t){return new Po(void 0,t)}static updateTime(t){return new Po(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Vo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Fo{}function Uo(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Xo(t.key,Po.none()):new Ko(t.key,t.data,Po.none());{const n=t.data,r=fi.empty();let s=new Fs(is.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new Go(t.key,r,new Bs(s.toArray()),Po.none())}}function Bo(t,e,n){t instanceof Ko?function(t,e,n){const r=t.value.clone(),s=Ho(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Go?function(t,e,n){if(!Vo(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Ho(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Qo(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function jo(t,e,n,r){return t instanceof Ko?function(t,e,n,r){if(!Vo(t.precondition,e))return n;const s=t.value.clone(),i=Wo(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof Go?function(t,e,n,r){if(!Vo(t.precondition,e))return n;const s=Wo(t.fieldTransforms,r,e),i=e.data;return i.setAll(Qo(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Vo(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function qo(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=Io(r.transform,t||null);null!=s&&(null===n&&(n=fi.empty()),n.set(r.field,s))}return n||null}function zo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Zr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Do&&e instanceof Do||t instanceof ko&&e instanceof ko?Zr(t.elements,e.elements,ti):t instanceof Ro&&e instanceof Ro?ti(t.Ie,e.Ie):t instanceof Ao&&e instanceof Ao}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ko extends Fo{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Go extends Fo{constructor(t,e,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Qo(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Ho(t,e,n){const r=new Map;Vr(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Co(o,a,n[s]))}return r}function Wo(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,So(t,i,e))}return r}class Xo extends Fo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Yo extends Fo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Jo{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let r=0;r<this.mutations.length;r++){const e=this.mutations[r];e.key.isEqual(t.key)&&Bo(e,t,n[r])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=jo(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=jo(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=fo();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=Uo(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(es.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),yo())}isEqual(t){return this.batchId===t.batchId&&Zr(this.mutations,t.mutations,((t,e)=>zo(t,e)))&&Zr(this.baseMutations,t.baseMutations,((t,e)=>zo(t,e)))}}class $o{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Vr(t.mutations.length===n.length);let r=mo;const s=t.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new $o(t,e,n,r)}}class Zo{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class ta{constructor(t,e){this.count=t,this.unchangedNames=e}}var ea,na;function ra(t){switch(t){default:return Pr();case Ur.CANCELLED:case Ur.UNKNOWN:case Ur.DEADLINE_EXCEEDED:case Ur.RESOURCE_EXHAUSTED:case Ur.INTERNAL:case Ur.UNAVAILABLE:case Ur.UNAUTHENTICATED:return!1;case Ur.INVALID_ARGUMENT:case Ur.NOT_FOUND:case Ur.ALREADY_EXISTS:case Ur.PERMISSION_DENIED:case Ur.FAILED_PRECONDITION:case Ur.ABORTED:case Ur.OUT_OF_RANGE:case Ur.UNIMPLEMENTED:case Ur.DATA_LOSS:return!0}}function sa(t){if(void 0===t)return Lr("GRPC error has no .code"),Ur.UNKNOWN;switch(t){case ea.OK:return Ur.OK;case ea.CANCELLED:return Ur.CANCELLED;case ea.UNKNOWN:return Ur.UNKNOWN;case ea.DEADLINE_EXCEEDED:return Ur.DEADLINE_EXCEEDED;case ea.RESOURCE_EXHAUSTED:return Ur.RESOURCE_EXHAUSTED;case ea.INTERNAL:return Ur.INTERNAL;case ea.UNAVAILABLE:return Ur.UNAVAILABLE;case ea.UNAUTHENTICATED:return Ur.UNAUTHENTICATED;case ea.INVALID_ARGUMENT:return Ur.INVALID_ARGUMENT;case ea.NOT_FOUND:return Ur.NOT_FOUND;case ea.ALREADY_EXISTS:return Ur.ALREADY_EXISTS;case ea.PERMISSION_DENIED:return Ur.PERMISSION_DENIED;case ea.FAILED_PRECONDITION:return Ur.FAILED_PRECONDITION;case ea.ABORTED:return Ur.ABORTED;case ea.OUT_OF_RANGE:return Ur.OUT_OF_RANGE;case ea.UNIMPLEMENTED:return Ur.UNIMPLEMENTED;case ea.DATA_LOSS:return Ur.DATA_LOSS;default:return Pr()}}(na=ea||(ea={}))[na.OK=0]="OK",na[na.CANCELLED=1]="CANCELLED",na[na.UNKNOWN=2]="UNKNOWN",na[na.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",na[na.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",na[na.NOT_FOUND=5]="NOT_FOUND",na[na.ALREADY_EXISTS=6]="ALREADY_EXISTS",na[na.PERMISSION_DENIED=7]="PERMISSION_DENIED",na[na.UNAUTHENTICATED=16]="UNAUTHENTICATED",na[na.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",na[na.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",na[na.ABORTED=10]="ABORTED",na[na.OUT_OF_RANGE=11]="OUT_OF_RANGE",na[na.UNIMPLEMENTED=12]="UNIMPLEMENTED",na[na.INTERNAL=13]="INTERNAL",na[na.UNAVAILABLE=14]="UNAVAILABLE",na[na.DATA_LOSS=15]="DATA_LOSS";let ia=null;function oa(){return new TextEncoder}const aa=new Ir([4294967295,4294967295],0);function ca(t){const e=oa().encode(t),n=new Cr;return n.update(e),new Uint8Array(n.digest())}function ua(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Ir([n,r],0),new Ir([s,i],0)]}class ha{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new la("Invalid padding: ".concat(e));if(n<0)throw new la("Invalid hash count: ".concat(n));if(t.length>0&&0===this.hashCount)throw new la("Invalid hash count: ".concat(n));if(0===t.length&&0!==e)throw new la("Invalid padding when bitmap length is 0: ".concat(e));this.Te=8*t.length-e,this.Ee=Ir.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(Ir.fromNumber(n)));return 1===r.compare(aa)&&(r=new Ir([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=ca(t),[n,r]=ua(e);for(let s=0;s<this.hashCount;s++){const t=this.de(n,r,s);if(!this.Ae(t))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new ha(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.Te)return;const e=ca(t),[n,r]=ua(e);for(let s=0;s<this.hashCount;s++){const t=this.de(n,r,s);this.Re(t)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class la extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class da{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,fa.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new da(es.min(),r,new Ms($r),ao(),yo())}}class fa{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new fa(n,e,yo(),yo(),yo())}}class ga{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class ma{constructor(t,e){this.targetId=t,this.fe=e}}class pa{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qs.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class ya{constructor(){this.ge=0,this.pe=Ea(),this.ye=qs.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=yo(),e=yo(),n=yo();return this.pe.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Pr()}})),new fa(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=Ea()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,Vr(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class va{constructor(t){this.Be=t,this.ke=new Map,this.qe=ao(),this.Qe=wa(),this.Ke=new Ms($r)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Le(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:Pr()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const s=r.target;if(qi(s))if(0===n){const t=new os(s.path);this.We(e,t,mi.newNoDocument(t,es.min()))}else Vr(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),s=n?this.et(n,t,r):1;if(0!==s){this.He(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}null==ia||ia.tt(function(t,e,n,r,s){var i,o,a,c,u,h;const l={localCacheCount:t,existenceFilterCount:e.count,databaseId:n.database,projectId:n.projectId},d=e.unchangedNames;return d&&(l.bloomFilter={applied:0===s,hashCount:null!==(i=null==d?void 0:d.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(c=null===(a=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===a?void 0:a.length)&&void 0!==c?c:0,padding:null!==(h=null===(u=null==d?void 0:d.bits)||void 0===u?void 0:u.padding)&&void 0!==h?h:0,mightContain:t=>{var e;return null!==(e=null==r?void 0:r.mightContain(t))&&void 0!==e&&e}}),l}(r,t.fe,this.Be.nt(),n,s))}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=Qs(n).toUint8Array()}catch(t){if(t instanceof js)return Or("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new ha(i,r,s)}catch(t){return Or(t instanceof la?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Be.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const s=this.Be.nt(),i="projects/".concat(s.projectId,"/databases/").concat(s.database,"/documents/").concat(n.path.canonicalString());t.mightContain(i)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const s=this.Ye(r);if(s){if(n.current&&qi(s.target)){const e=new os(s.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,mi.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=yo();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new da(t,e,this.Ke,this.qe,n);return this.qe=ao(),this.Qe=wa(),this.Ke=new Ms($r),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new ya,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new Fs($r),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||Rr("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Be._t(t)}He(t){this.ke.set(t,new ya),this.Be.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Be.getRemoteKeysForTarget(t).has(e)}}function wa(){return new Ms(os.comparator)}function Ea(){return new Ms(os.comparator)}const Ta={asc:"ASCENDING",desc:"DESCENDING"},_a={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ba={and:"AND",or:"OR"};class Sa{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Ca(t,e){return t.useProto3Json||Is(e)?e:{value:e}}function Ia(t,e){return t.useProto3Json?"".concat(new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+e.nanoseconds).slice(-9),"Z"):{seconds:""+e.seconds,nanos:e.nanoseconds}}function Aa(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Da(t,e){return Ia(t,e.toTimestamp())}function Na(t){return Vr(!!t),es.fromTimestamp(function(t){const e=Ks(t);return new ts(e.seconds,e.nanos)}(t))}function ka(t,e){return xa(t,e).canonicalString()}function xa(t,e){const n=function(t){return new rs(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Ra(t){const e=rs.fromString(t);return Vr($a(e)),e}function La(t,e){return ka(t.databaseId,e.path)}function Oa(t,e){const n=Ra(e);if(n.get(1)!==t.databaseId.projectId)throw new Br(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Br(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new os(Fa(n))}function Ma(t,e){return ka(t.databaseId,e)}function Pa(t){const e=Ra(t);return 4===e.length?rs.emptyPath():Fa(e)}function Va(t){return new rs(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Fa(t){return Vr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ua(t,e,n){return{name:La(t,e),fields:n.value.mapValue.fields}}function Ba(t,e){let n;if(e instanceof Ko)n={update:Ua(t,e.key,e.value)};else if(e instanceof Xo)n={delete:La(t,e.key)};else if(e instanceof Go)n={update:Ua(t,e.key,e.data),updateMask:Ja(e.fieldMask)};else{if(!(e instanceof Yo))return Pr();n={verify:La(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Ao)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Do)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ko)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ro)return{fieldPath:e.field.canonicalString(),increment:n.Ie};throw Pr()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Da(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Pr()}(t,e.precondition)),n}function ja(t,e){return{documents:[Ma(t,e.path)]}}function qa(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ma(t,s);const i=function(t){if(0!==t.length)return Ya(bi.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Wa(t.field),direction:Ga(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Ca(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:s}}function za(t){let e=Pa(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Vr(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=Ka(t);return e instanceof bi&&Ci(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new wi(Xa(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Is(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new pi(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new pi(n,e)}(n.endAt)),Ki(e,s,o,i,a,"F",c,u)}function Ka(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Xa(t.unaryFilter.field);return _i.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Xa(t.unaryFilter.field);return _i.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Xa(t.unaryFilter.field);return _i.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Xa(t.unaryFilter.field);return _i.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Pr()}}(t):void 0!==t.fieldFilter?function(t){return _i.create(Xa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Pr()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return bi.create(t.compositeFilter.filters.map((t=>Ka(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Pr()}}(t.compositeFilter.op))}(t):Pr()}function Ga(t){return Ta[t]}function Qa(t){return _a[t]}function Ha(t){return ba[t]}function Wa(t){return{fieldPath:t.canonicalString()}}function Xa(t){return is.fromServerFormat(t.fieldPath)}function Ya(t){return t instanceof _i?function(t){if("=="===t.op){if(ui(t.value))return{unaryFilter:{field:Wa(t.field),op:"IS_NAN"}};if(ci(t.value))return{unaryFilter:{field:Wa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ui(t.value))return{unaryFilter:{field:Wa(t.field),op:"IS_NOT_NAN"}};if(ci(t.value))return{unaryFilter:{field:Wa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wa(t.field),op:Qa(t.op),value:t.value}}}(t):t instanceof bi?function(t){const e=t.getFilters().map((t=>Ya(t)));return 1===e.length?e[0]:{compositeFilter:{op:Ha(t.op),filters:e}}}(t):Pr()}function Ja(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function $a(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Za{constructor(t,e,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:es.min(),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:es.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:qs.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Za(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Za(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Za(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Za(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class tc{constructor(t){this.ct=t}}function ec(t){const e=za({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ji(e,e.limit,"L"):e}class nc{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Gs(t.integerValue));else if("doubleValue"in t){const n=Gs(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),As(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Et(e,20),"string"==typeof n&&(n=Ks(n)),e.At("".concat(n.seconds||"")),e.dt(n.nanos||0)}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Qs(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?di(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):Pr()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const r of Object.keys(n))this.Rt(r,e),this.It(n[r],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const r of n)this.It(r,e)}gt(t,e){this.Et(e,37),os.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}nc.bt=new nc;class rc{constructor(){this._n=new sc}addToCollectionParentIndex(t,e){return this._n.add(e),ms.resolve()}getCollectionParents(t,e){return ms.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return ms.resolve()}deleteFieldIndex(t,e){return ms.resolve()}deleteAllFieldIndexes(t){return ms.resolve()}createTargetIndexes(t,e){return ms.resolve()}getDocumentsMatchingTarget(t,e){return ms.resolve(null)}getIndexType(t,e){return ms.resolve(0)}getFieldIndexes(t,e){return ms.resolve([])}getNextCollectionGroupToUpdate(t){return ms.resolve(null)}getMinOffset(t,e){return ms.resolve(hs.min())}getMinOffsetFromCollectionGroup(t,e){return ms.resolve(hs.min())}updateCollectionGroup(t,e,n){return ms.resolve()}updateIndexEntries(t,e){return ms.resolve()}}class sc{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Fs(rs.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Fs(rs.comparator)).toArray()}}new Uint8Array(0);class ic{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new ic(t,ic.DEFAULT_COLLECTION_PERCENTILE,ic.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}ic.DEFAULT_COLLECTION_PERCENTILE=10,ic.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ic.DEFAULT=new ic(41943040,ic.DEFAULT_COLLECTION_PERCENTILE,ic.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ic.DISABLED=new ic(-1,0,0);class oc{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new oc(0)}static Ln(){return new oc(-1)}}class ac{constructor(){this.changes=new io((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,mi.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?ms.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class cc{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class uc{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&jo(n.mutation,t,Bs.empty(),ts.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,yo()).next((()=>e))))}getLocalViewOfDocuments(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yo();const r=lo();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=uo();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=lo();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,yo())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=ao();const i=go(),o=go();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Go)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),jo(o.mutation,e,o.mutation.getFieldMask(),ts.now())):i.set(e.key,Bs.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new cc(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=go();let r=new Ms(((t,e)=>t-e)),s=yo();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||Bs.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||yo()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=fo();c.forEach((t=>{if(!s.has(t)){const r=Uo(e.get(t),n.get(t));null!==r&&u.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,u))}return ms.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return os.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Hi(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):ms.resolve(lo());let o=-1,a=s;return i.next((e=>ms.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?ms.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,yo()))).next((t=>({batchId:o,changes:ho(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new os(e)).next((t=>{let e=uo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=uo();return this.indexManager.getCollectionParents(t,s).next((o=>ms.forEach(o,(o=>{const a=function(t,e){return new zi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r)))).next((t=>{s.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,mi.newInvalidDocument(r)))}));let n=uo();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&jo(i.mutation,r,Bs.empty(),ts.now()),eo(e,r)&&(n=n.insert(t,r))})),n}))}}class hc{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return ms.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Na(t.createTime)}}(e)),ms.resolve()}getNamedQuery(t,e){return ms.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:ec(t.bundledQuery),readTime:Na(t.readTime)}}(e)),ms.resolve()}}class lc{constructor(){this.overlays=new Ms(os.comparator),this.hr=new Map}getOverlay(t,e){return ms.resolve(this.overlays.get(e))}getOverlays(t,e){const n=lo();return ms.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),ms.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),ms.resolve()}getOverlaysForCollection(t,e,n){const r=lo(),s=e.length+1,i=new os(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return ms.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new Ms(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=lo(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=lo(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return ms.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Zo(e,n));let s=this.hr.get(e);void 0===s&&(s=yo(),this.hr.set(e,s)),this.hr.set(e,s.add(n.key))}}class dc{constructor(){this.Pr=new Fs(fc.Ir),this.Tr=new Fs(fc.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new fc(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new fc(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new os(new rs([])),n=new fc(e,t),r=new fc(e,t+1),s=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),s.push(t.key)})),s}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new os(new rs([])),n=new fc(e,t),r=new fc(e,t+1);let s=yo();return this.Tr.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new fc(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class fc{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return os.comparator(t.key,e.key)||$r(t.pr,e.pr)}static Er(t,e){return $r(t.pr,e.pr)||os.comparator(t.key,e.key)}}class gc{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new Fs(fc.Ir)}checkEmpty(t){return ms.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Jo(s,e,n,r);this.mutationQueue.push(i);for(const o of r)this.wr=this.wr.add(new fc(o.key,s)),this.indexManager.addToCollectionParentIndex(t,o.key.path.popLast());return ms.resolve(i)}lookupMutationBatch(t,e){return ms.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),s=r<0?0:r;return ms.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ms.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return ms.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new fc(e,0),r=new fc(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);s.push(e)})),ms.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Fs($r);return e.forEach((t=>{const e=new fc(t,0),r=new fc(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),ms.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;os.isDocumentKey(s)||(s=s.child(""));const i=new fc(new os(s),0);let o=new Fs($r);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),i),ms.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Vr(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return ms.forEach(e.mutations,(r=>{const s=new fc(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new fc(e,0),r=this.wr.firstAfterOrEqual(n);return ms.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,ms.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class mc{constructor(t){this.vr=t,this.docs=new Ms(os.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return ms.resolve(n?n.document.mutableCopy():mi.newInvalidDocument(e))}getEntries(t,e){let n=ao();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():mi.newInvalidDocument(t))})),ms.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=ao();const i=e.path,o=new os(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||ls(us(o),n)<=0||(r.has(o.key)||eo(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return ms.resolve(s)}getAllFromCollectionGroup(t,e,n,r){Pr()}Fr(t,e){return ms.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new pc(this)}getSize(t){return ms.resolve(this.size)}}class pc extends ac{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),ms.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class yc{constructor(t){this.persistence=t,this.Mr=new io((t=>Bi(t)),ji),this.lastRemoteSnapshotVersion=es.min(),this.highestTargetId=0,this.Or=0,this.Nr=new dc,this.targetCount=0,this.Lr=oc.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),ms.resolve()}getLastRemoteSnapshotVersion(t){return ms.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return ms.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),ms.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),ms.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Lr=new oc(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,ms.resolve()}updateTargetData(t,e){return this.qn(e),ms.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,ms.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Mr.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),ms.waitFor(s).next((()=>r))}getTargetCount(t){return ms.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return ms.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),ms.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),ms.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),ms.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return ms.resolve(n)}containsKey(t,e){return ms.resolve(this.Nr.containsKey(e))}}class vc{constructor(t,e){this.Br={},this.overlays={},this.kr=new Cs(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new yc(this),this.indexManager=new rc,this.remoteDocumentCache=function(t){return new mc(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new tc(e),this.$r=new hc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new lc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new gc(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){Rr("MemoryPersistence","Starting transaction:",t);const r=new wc(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return ms.or(Object.values(this.Br).map((n=>()=>n.containsKey(t,e))))}}class wc extends fs{constructor(t){super(),this.currentSequenceNumber=t}}class Ec{constructor(t){this.persistence=t,this.zr=new dc,this.jr=null}static Hr(t){return new Ec(t)}get Jr(){if(this.jr)return this.jr;throw Pr()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),ms.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),ms.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),ms.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ms.forEach(this.Jr,(n=>{const r=os.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,es.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return ms.or([()=>ms.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class Tc{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=yo(),r=yo();for(const s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Tc(t,e.fromCache,n,r)}}class _c{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class bc{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,a.nr)()?8:ys.v((0,a.ZQ)())>0?6:4}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.ji(t,e).next((t=>{s.result=t})).next((()=>{if(!s.result)return this.Hi(t,e,r,n).next((t=>{s.result=t}))})).next((()=>{if(s.result)return;const n=new _c;return this.Ji(t,e,n).next((r=>{if(s.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>s.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(xr()<=o.$b.DEBUG&&Rr("QueryEngine","SDK will not create cache indexes for query:",to(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),ms.resolve()):(xr()<=o.$b.DEBUG&&Rr("QueryEngine","Query:",to(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(xr()<=o.$b.DEBUG&&Rr("QueryEngine","The SDK decides to create cache indexes for query:",to(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Xi(e))):ms.resolve())}ji(t,e){if(Qi(e))return ms.resolve(null);let n=Xi(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Ji(e,null,"F"),n=Xi(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=yo(...r);return this.zi.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Zi(e,r);return this.Xi(e,i,s,n.readTime)?this.ji(t,Ji(e,null,"F")):this.es(t,i,e,n)}))))})))))}Hi(t,e,n,r){return Qi(e)||r.isEqual(es.min())?ms.resolve(null):this.zi.getDocuments(t,n).next((s=>{const i=this.Zi(e,s);return this.Xi(e,i,n,r)?ms.resolve(null):(xr()<=o.$b.DEBUG&&Rr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),to(e)),this.es(t,i,e,cs(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new Fs(ro(t));return e.forEach(((e,r)=>{eo(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(t,e,n){return xr()<=o.$b.DEBUG&&Rr("QueryEngine","Using full collection scan to execute query:",to(e)),this.zi.getDocumentsMatchingQuery(t,e,hs.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Sc{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new Ms($r),this.rs=new io((t=>Bi(t)),ji),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new uc(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}function Cc(t,e,n,r){return new Sc(t,e,n,r)}async function Ic(t,e){const n=Fr(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=yo();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function Ac(t){const e=Fr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}function Dc(t,e,n){let r=yo(),s=yo();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=ao();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(es.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):Rr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{cs:r,ls:s}}))}function Nc(t,e){const n=Fr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function kc(t,e){const n=Fr(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((s=>s?(r=s,ms.resolve(r)):n.Qr.allocateTargetId(t).next((s=>(r=new Za(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}async function xc(t,e,n){const r=Fr(t),s=r.ns.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Es(t))throw t;Rr("LocalStore","Failed to update sequence numbers for target ".concat(e,": ").concat(t))}r.ns=r.ns.remove(e),r.rs.delete(s.target)}function Rc(t,e,n){const r=Fr(t);let s=es.min(),i=yo();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Fr(t),s=r.rs.get(n);return void 0!==s?ms.resolve(r.ns.get(s)):r.Qr.getTargetData(e,n)}(r,t,Xi(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?s:es.min(),n?i:yo()))).next((t=>(Lc(r,no(e),t),{documents:t,hs:i})))))}function Lc(t,e,n){let r=t.ss.get(e)||es.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}class Oc{constructor(){this.activeTargetIds=wo()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Mc{constructor(){this.no=new Oc,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Oc,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Pc{io(t){}shutdown(){}}class Vc{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Rr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){Rr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Fc=null;function Uc(){return null===Fc?Fc=268435456+Math.round(2147483648*Math.random()):Fc++,"0x"+Fc.toString(16)}const Bc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class jc{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const qc="WebChannelConnection";class zc extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po="projects/".concat(n,"/databases/").concat(r),this.yo="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}get wo(){return!1}So(t,e,n,r,s){const i=Uc(),o=this.bo(t,e.toUriEncodedString());Rr("RestConnection","Sending RPC '".concat(t,"' ").concat(i,":"),o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,s),this.Co(t,o,a,n).then((e=>(Rr("RestConnection","Received RPC '".concat(t,"' ").concat(i,": "),e),e)),(e=>{throw Or("RestConnection","RPC '".concat(t,"' ").concat(i," failed with error: "),e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,s,i){return this.So(t,e,n,r,s)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Nr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=Bc[t];return"".concat(this.fo,"/v1/").concat(e,":").concat(n)}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,r){const s=Uc();return new Promise(((i,o)=>{const a=new Sr;a.setWithCredentials(!0),a.listenOnce(Er.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case wr.NO_ERROR:const e=a.getResponseJson();Rr(qc,"XHR for RPC '".concat(t,"' ").concat(s," received:"),JSON.stringify(e)),i(e);break;case wr.TIMEOUT:Rr(qc,"RPC '".concat(t,"' ").concat(s," timed out")),o(new Br(Ur.DEADLINE_EXCEEDED,"Request time out"));break;case wr.HTTP_ERROR:const n=a.getStatus();if(Rr(qc,"RPC '".concat(t,"' ").concat(s," failed with status:"),n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Ur).indexOf(e)>=0?e:Ur.UNKNOWN}(e.status);o(new Br(t,e.message))}else o(new Br(Ur.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Br(Ur.UNAVAILABLE,"Connection failed."));break;default:Pr()}}finally{Rr(qc,"RPC '".concat(t,"' ").concat(s," completed."))}}));const c=JSON.stringify(r);Rr(qc,"RPC '".concat(t,"' ").concat(s," sending request:"),r),a.send(e,"POST",c,n,15)}))}Fo(t,e,n){const r=Uc(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=yr(),o=vr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=s.join("");Rr(qc,"Creating RPC '".concat(t,"' stream ").concat(r,": ").concat(u),a);const h=i.createWebChannel(u,a);let l=!1,d=!1;const f=new jc({lo:e=>{d?Rr(qc,"Not sending because RPC '".concat(t,"' stream ").concat(r," is closed:"),e):(l||(Rr(qc,"Opening RPC '".concat(t,"' stream ").concat(r," transport.")),h.open(),l=!0),Rr(qc,"RPC '".concat(t,"' stream ").concat(r," sending:"),e),h.send(e))},ho:()=>h.close()}),g=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return g(h,br.EventType.OPEN,(()=>{d||Rr(qc,"RPC '".concat(t,"' stream ").concat(r," transport opened."))})),g(h,br.EventType.CLOSE,(()=>{d||(d=!0,Rr(qc,"RPC '".concat(t,"' stream ").concat(r," transport closed")),f.Vo())})),g(h,br.EventType.ERROR,(e=>{d||(d=!0,Or(qc,"RPC '".concat(t,"' stream ").concat(r," transport errored:"),e),f.Vo(new Br(Ur.UNAVAILABLE,"The operation could not be completed")))})),g(h,br.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];Vr(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){Rr(qc,"RPC '".concat(t,"' stream ").concat(r," received error:"),o);const e=o.status;let n=function(t){const e=ea[t];if(void 0!==e)return sa(e)}(e),s=o.message;void 0===n&&(n=Ur.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new Br(n,s)),h.close()}else Rr(qc,"RPC '".concat(t,"' stream ").concat(r," received:"),s),f.mo(s)}})),g(o,Tr.STAT_EVENT,(e=>{e.stat===_r.PROXY?Rr(qc,"RPC '".concat(t,"' stream ").concat(r," detected buffering proxy")):e.stat===_r.NOPROXY&&Rr(qc,"RPC '".concat(t,"' stream ").concat(r," detected no buffering proxy"))})),setTimeout((()=>{f.Ro()}),0),f}}function Kc(){return"undefined"!=typeof document?document:null}function Gc(t){return new Sa(t,!0)}class Qc{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.oi=t,this.timerId=e,this.Mo=n,this.xo=r,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,e-n);r>0&&Rr("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.No," ms, delay with jitter: ").concat(e," ms, last attempt: ").concat(n," ms ago)")),this.Lo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class Hc{constructor(t,e,n,r,s,i,o,a){this.oi=t,this.$o=n,this.Uo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Qc(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===Ur.RESOURCE_EXHAUSTED?(Lr(e.toString()),Lr("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===Ur.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((t=>{let[n,r]=t;this.Wo===e&&this.o_(n,r)}),(e=>{t((()=>{const t=new Br(Ur.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return Rr("PersistentStream","close with error: ".concat(t)),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(Rr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Wc extends Hc{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Pr()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(Vr(void 0===e||"string"==typeof e),qs.fromBase64String(e||"")):(Vr(void 0===e||e instanceof Buffer||e instanceof Uint8Array),qs.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Ur.UNKNOWN:sa(t.code);return new Br(e,t.message||"")}(o);n=new pa(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Oa(t,r.document.name),i=Na(r.document.updateTime),o=r.document.createTime?Na(r.document.createTime):es.min(),a=new fi({mapValue:{fields:r.document.fields}}),c=mi.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new ga(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Oa(t,r.document),i=r.readTime?Na(r.readTime):es.min(),o=mi.newNoDocument(s,i),a=r.removedTargetIds||[];n=new ga([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Oa(t,r.document),i=r.removedTargetIds||[];n=new ga([],i,s,null)}else{if(!("filter"in e))return Pr();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new ta(r,s),o=t.targetId;n=new ma(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return es.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?es.min():e.readTime?Na(e.readTime):es.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=Va(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=qi(r)?{documents:ja(t,r)}:{query:qa(t,r).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Aa(t,e.resumeToken);const r=Ca(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(es.min())>0){n.readTime=Ia(t,e.snapshotVersion.toTimestamp());const r=Ca(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Pr()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=Va(this.serializer),e.removeTarget=t,this.t_(e)}}class Xc extends Hc{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(Vr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();const e=function(t,e){return t&&t.length>0?(Vr(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Na(t.updateTime):Na(e);return n.isEqual(es.min())&&(n=Na(e)),new Mo(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Na(t.commitTime);return this.listener.T_(n,e)}return Vr(!t.writeResults||0===t.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const t={};t.database=Va(this.serializer),this.t_(t)}I_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Ba(this.serializer,t)))};this.t_(e)}}class Yc extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new Br(Ur.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((s=>{let[i,o]=s;return this.connection.So(t,xa(e,n),r,i,o)})).catch((t=>{throw"FirebaseError"===t.name?(t.code===Ur.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Br(Ur.UNKNOWN,t.toString())}))}vo(t,e,n,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((i=>{let[o,a]=i;return this.connection.vo(t,xa(e,n),r,o,a,s)})).catch((t=>{throw"FirebaseError"===t.name?(t.code===Ur.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Br(Ur.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Jc{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_("Connection failed 1 times. Most recent error: ".concat(t.toString())),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e="Could not reach Cloud Firestore backend. ".concat(t,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.g_?(Lr(e),this.g_=!1):Rr("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class $c{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io((t=>{n.enqueueAndForget((async()=>{au(this)&&(Rr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Fr(t);e.v_.add(4),await tu(e),e.x_.set("Unknown"),e.v_.delete(4),await Zc(e)}(this))}))})),this.x_=new Jc(n,r)}}async function Zc(t){if(au(t))for(const e of t.F_)await e(!0)}async function tu(t){for(const e of t.F_)await e(!1)}function eu(t,e){const n=Fr(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),ou(n)?iu(n):Cu(n).Jo()&&ru(n,e))}function nu(t,e){const n=Fr(t),r=Cu(n);n.C_.delete(e),r.Jo()&&su(n,e),0===n.C_.size&&(r.Jo()?r.Xo():au(n)&&n.x_.set("Unknown"))}function ru(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(es.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Cu(t).c_(e)}function su(t,e){t.O_.Oe(e),Cu(t).l_(e)}function iu(t){t.O_=new va({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Cu(t).start(),t.x_.p_()}function ou(t){return au(t)&&!Cu(t).Ho()&&t.C_.size>0}function au(t){return 0===Fr(t).v_.size}function cu(t){t.O_=void 0}async function uu(t){t.C_.forEach(((e,n)=>{ru(t,e)}))}async function hu(t,e){cu(t),ou(t)?(t.x_.S_(e),iu(t)):t.x_.set("Unknown")}async function lu(t,e,n){if(t.x_.set("Online"),e instanceof pa&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.C_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.C_.delete(r),t.O_.removeTarget(r))}(t,e)}catch(n){Rr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await du(t,n)}else if(e instanceof ga?t.O_.$e(e):e instanceof ma?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(es.min()))try{const e=await Ac(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.C_.get(r);s&&t.C_.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.C_.get(e);if(!r)return;t.C_.set(e,r.withResumeToken(qs.EMPTY_BYTE_STRING,r.snapshotVersion)),su(t,e);const s=new Za(r.target,e,n,r.sequenceNumber);ru(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Rr("RemoteStore","Failed to raise snapshot:",e),await du(t,e)}}async function du(t,e,n){if(!Es(e))throw e;t.v_.add(1),await tu(t),t.x_.set("Offline"),n||(n=()=>Ac(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Rr("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await Zc(t)}))}function fu(t,e){return e().catch((n=>du(t,n,e)))}async function gu(t){const e=Fr(t),n=Iu(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;mu(e);)try{const t=await Nc(e.localStore,r);if(null===t){0===e.D_.length&&n.Xo();break}r=t.batchId,pu(e,t)}catch(t){await du(e,t)}yu(e)&&vu(e)}function mu(t){return au(t)&&t.D_.length<10}function pu(t,e){t.D_.push(e);const n=Iu(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function yu(t){return au(t)&&!Iu(t).Ho()&&t.D_.length>0}function vu(t){Iu(t).start()}async function wu(t){Iu(t).d_()}async function Eu(t){const e=Iu(t);for(const n of t.D_)e.I_(n.mutations)}async function Tu(t,e,n){const r=t.D_.shift(),s=$o.from(r,e,n);await fu(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await gu(t)}async function _u(t,e){e&&Iu(t).P_&&await async function(t,e){if(function(t){return ra(t)&&t!==Ur.ABORTED}(e.code)){const n=t.D_.shift();Iu(t).Zo(),await fu(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await gu(t)}}(t,e),yu(t)&&vu(t)}async function bu(t,e){const n=Fr(t);n.asyncQueue.verifyOperationInProgress(),Rr("RemoteStore","RemoteStore received new credentials");const r=au(n);n.v_.add(3),await tu(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await Zc(n)}async function Su(t,e){const n=Fr(t);e?(n.v_.delete(2),await Zc(n)):e||(n.v_.add(2),await tu(n),n.x_.set("Unknown"))}function Cu(t){return t.N_||(t.N_=function(t,e,n){const r=Fr(t);return r.R_(),new Wc(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:uu.bind(null,t),To:hu.bind(null,t),u_:lu.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),ou(t)?iu(t):t.x_.set("Unknown")):(await t.N_.stop(),cu(t))}))),t.N_}function Iu(t){return t.L_||(t.L_=function(t,e,n){const r=Fr(t);return r.R_(),new Xc(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:wu.bind(null,t),To:_u.bind(null,t),E_:Eu.bind(null,t),T_:Tu.bind(null,t)}),t.F_.push((async e=>{e?(t.L_.Zo(),await gu(t)):(await t.L_.stop(),t.D_.length>0&&(Rr("RemoteStore","Stopping write stream with ".concat(t.D_.length," pending writes")),t.D_=[]))}))),t.L_}class Au{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new jr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Au(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Br(Ur.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Du(t,e){if(Lr("AsyncQueue","".concat(e,": ").concat(t)),Es(t))return new Br(Ur.UNAVAILABLE,"".concat(e,": ").concat(t));throw t}class Nu{constructor(t){this.comparator=t?(e,n)=>t(e,n)||os.comparator(e.key,n.key):(t,e)=>os.comparator(t.key,e.key),this.keyedMap=uo(),this.sortedSet=new Ms(this.comparator)}static emptySet(t){return new Nu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Nu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Nu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class ku{constructor(){this.B_=new Ms(os.comparator)}track(t){const e=t.doc.key,n=this.B_.get(e);n?0!==t.type&&3===n.type?this.B_=this.B_.insert(e,t):3===t.type&&1!==n.type?this.B_=this.B_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.B_=this.B_.remove(e):1===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):Pr():this.B_=this.B_.insert(e,t)}k_(){const t=[];return this.B_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class xu{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new xu(t,e,Nu.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&$i(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0}}class Ru{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some((t=>t.U_()))}}class Lu{constructor(){this.queries=new io((t=>Zi(t)),$i),this.onlineState="Unknown",this.W_=new Set}}async function Ou(t,e){const n=Fr(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.K_()&&e.U_()&&(r=2):(i=new Ru,r=e.U_()?0:1);try{switch(r){case 0:i.q_=await n.onListen(s,!0);break;case 1:i.q_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(t){const n=Du(t,"Initialization of query '".concat(to(e.query),"' failed"));return void e.onError(n)}n.queries.set(s,i),i.Q_.push(e),e.G_(n.onlineState),i.q_&&e.z_(i.q_)&&Fu(n)}async function Mu(t,e){const n=Fr(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const t=i.Q_.indexOf(e);t>=0&&(i.Q_.splice(t,1),0===i.Q_.length?s=e.U_()?0:1:!i.K_()&&e.U_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Pu(t,e){const n=Fr(t);let r=!1;for(const s of e){const t=s.query,e=n.queries.get(t);if(e){for(const t of e.Q_)t.z_(s)&&(r=!0);e.q_=s}}r&&Fu(n)}function Vu(t,e,n){const r=Fr(t),s=r.queries.get(e);if(s)for(const i of s.Q_)i.onError(n);r.queries.delete(e)}function Fu(t){t.W_.forEach((t=>{t.next()}))}var Uu,Bu;(Bu=Uu||(Uu={})).j_="default",Bu.Cache="cache";class ju{constructor(t,e,n){this.query=t,this.H_=e,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=n||{}}z_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new xu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.J_?this.Z_(t)&&(this.H_.next(t),e=!0):this.X_(t,this.onlineState)&&(this.ea(t),e=!0),this.Y_=t,e}onError(t){this.H_.error(t)}G_(t){this.onlineState=t;let e=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,t)&&(this.ea(this.Y_),e=!0),e}X_(t,e){if(!t.fromCache)return!0;if(!this.U_())return!0;const n="Offline"!==e;return(!this.options.ta||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Z_(t){if(t.docChanges.length>0)return!0;const e=this.Y_&&this.Y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ea(t){t=xu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.J_=!0,this.H_.next(t)}U_(){return this.options.source!==Uu.Cache}}class qu{constructor(t){this.key=t}}class zu{constructor(t){this.key=t}}class Ku{constructor(t,e){this.query=t,this.ua=e,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=yo(),this.mutatedKeys=yo(),this.ha=ro(t),this.Pa=new Nu(this.ha)}get Ia(){return this.ua}Ta(t,e){const n=e?e.Ea:new ku,r=e?e.Pa:this.Pa;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=eo(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.da(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.ha(h,a)>0||c&&this.ha(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Pa:i,Ea:n,Xi:o,mutatedKeys:s}}da(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const s=this.Pa;this.Pa=t.Pa,this.mutatedKeys=t.mutatedKeys;const i=t.Ea.k_();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Pr()}};return n(t)-n(e)}(t.type,e.type)||this.ha(t.doc,e.doc))),this.Aa(n),r=null!=r&&r;const o=e&&!r?this.Ra():[],a=0===this.la.size&&this.current&&!r?1:0,c=a!==this.ca;return this.ca=a,0!==i.length||c?{snapshot:new xu(this.query,t.Pa,s,i,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Va:o}:{Va:o}}G_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new ku,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(t){return!this.ua.has(t)&&!!this.Pa.has(t)&&!this.Pa.get(t).hasLocalMutations}Aa(t){t&&(t.addedDocuments.forEach((t=>this.ua=this.ua.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.ua=this.ua.delete(t))),this.current=t.current)}Ra(){if(!this.current)return[];const t=this.la;this.la=yo(),this.Pa.forEach((t=>{this.ma(t.key)&&(this.la=this.la.add(t.key))}));const e=[];return t.forEach((t=>{this.la.has(t)||e.push(new zu(t))})),this.la.forEach((n=>{t.has(n)||e.push(new qu(n))})),e}fa(t){this.ua=t.hs,this.la=yo();const e=this.Ta(t.documents);return this.applyChanges(e,!0)}ga(){return xu.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class Gu{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Qu{constructor(t){this.key=t,this.pa=!1}}class Hu{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.ya={},this.wa=new io((t=>Zi(t)),$i),this.Sa=new Map,this.ba=new Set,this.Da=new Ms(os.comparator),this.Ca=new Map,this.va=new dc,this.Fa={},this.Ma=new Map,this.xa=oc.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}async function Wu(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=mh(t);let s;const i=r.wa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.ga()):s=await Yu(r,e,n,!0),s}async function Xu(t,e){const n=mh(t);await Yu(n,e,!0,!1)}async function Yu(t,e,n,r){const s=await kc(t.localStore,Xi(e)),i=s.targetId,o=n?t.sharedClientState.addLocalQueryTarget(i):"not-current";let a;return r&&(a=await Ju(t,e,i,"current"===o,s.resumeToken)),t.isPrimaryClient&&n&&eu(t.remoteStore,s),a}async function Ju(t,e,n,r,s){t.Na=(e,n,r)=>async function(t,e,n,r){let s=e.view.Ta(n);s.Xi&&(s=await Rc(t.localStore,e.query,!1).then((t=>{let{documents:n}=t;return e.view.Ta(n,s)})));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return uh(t,e.targetId,a.Va),a.snapshot}(t,e,n,r);const i=await Rc(t.localStore,e,!0),o=new Ku(e,i.hs),a=o.Ta(i.documents),c=fa.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),u=o.applyChanges(a,t.isPrimaryClient,c);uh(t,n,u.Va);const h=new Gu(e,n,o);return t.wa.set(e,h),t.Sa.has(n)?t.Sa.get(n).push(e):t.Sa.set(n,[e]),u.snapshot}async function $u(t,e,n){const r=Fr(t),s=r.wa.get(e),i=r.Sa.get(s.targetId);if(i.length>1)return r.Sa.set(s.targetId,i.filter((t=>!$i(t,e)))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await xc(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&nu(r.remoteStore,s.targetId),ah(r,s.targetId)})).catch(gs)):(ah(r,s.targetId),await xc(r.localStore,s.targetId,!0))}async function Zu(t,e){const n=Fr(t),r=n.wa.get(e),s=n.Sa.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),nu(n.remoteStore,r.targetId))}async function th(t,e){const n=Fr(t);try{const t=await function(t,e){const n=Fr(t),r=e.snapshotVersion;let s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,i.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(qs.EMPTY_BYTE_STRING,es.min()).withLastLimboFreeSnapshotVersion(es.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Qr.updateTargetData(t,u))}));let a=ao(),c=yo();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(Dc(t,i,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!r.isEqual(es.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return ms.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Ca.get(e);r&&(Vr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.pa=!0:t.modifiedDocuments.size>0?Vr(r.pa):t.removedDocuments.size>0&&(Vr(r.pa),r.pa=!1))})),await dh(n,t,e)}catch(t){await gs(t)}}function eh(t,e,n){const r=Fr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.wa.forEach(((n,r)=>{const s=r.view.G_(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Fr(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const s of n.Q_)s.G_(e)&&(r=!0)})),r&&Fu(n)}(r.eventManager,e),t.length&&r.ya.u_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function nh(t,e,n){const r=Fr(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Ca.get(e),i=s&&s.key;if(i){let t=new Ms(os.comparator);t=t.insert(i,mi.newNoDocument(i,es.min()));const n=yo().add(i),s=new da(es.min(),new Map,new Ms($r),t,n);await th(r,s),r.Da=r.Da.remove(i),r.Ca.delete(e),lh(r)}else await xc(r.localStore,e,!1).then((()=>ah(r,e,n))).catch(gs)}async function rh(t,e){const n=Fr(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Fr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=ms.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);Vr(null!==i),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=yo();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);oh(n,r,null),ih(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await dh(n,t)}catch(t){await gs(t)}}async function sh(t,e,n){const r=Fr(t);try{const t=await function(t,e){const n=Fr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Vr(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);oh(r,e,n),ih(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await dh(r,t)}catch(n){await gs(n)}}function ih(t,e){(t.Ma.get(e)||[]).forEach((t=>{t.resolve()})),t.Ma.delete(e)}function oh(t,e,n){const r=Fr(t);let s=r.Fa[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.Fa[r.currentUser.toKey()]=s}}function ah(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Sa.get(e))t.wa.delete(r),n&&t.ya.La(r,n);t.Sa.delete(e),t.isPrimaryClient&&t.va.Vr(e).forEach((e=>{t.va.containsKey(e)||ch(t,e)}))}function ch(t,e){t.ba.delete(e.path.canonicalString());const n=t.Da.get(e);null!==n&&(nu(t.remoteStore,n),t.Da=t.Da.remove(e),t.Ca.delete(n),lh(t))}function uh(t,e,n){for(const r of n)r instanceof qu?(t.va.addReference(r.key,e),hh(t,r)):r instanceof zu?(Rr("SyncEngine","Document no longer in limbo: "+r.key),t.va.removeReference(r.key,e),t.va.containsKey(r.key)||ch(t,r.key)):Pr()}function hh(t,e){const n=e.key,r=n.path.canonicalString();t.Da.get(n)||t.ba.has(r)||(Rr("SyncEngine","New document in limbo: "+n),t.ba.add(r),lh(t))}function lh(t){for(;t.ba.size>0&&t.Da.size<t.maxConcurrentLimboResolutions;){const e=t.ba.values().next().value;t.ba.delete(e);const n=new os(rs.fromString(e)),r=t.xa.next();t.Ca.set(r,new Qu(n)),t.Da=t.Da.insert(n,r),eu(t.remoteStore,new Za(Xi(Gi(n.path)),r,"TargetPurposeLimboResolution",Cs._e))}}async function dh(t,e,n){const r=Fr(t),s=[],i=[],o=[];r.wa.isEmpty()||(r.wa.forEach(((t,a)=>{o.push(r.Na(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=Tc.Ki(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.ya.u_(s),await async function(t,e){const n=Fr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>ms.forEach(e,(e=>ms.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>ms.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Es(t))throw t;Rr("LocalStore","Failed to update sequence numbers: "+t)}for(const r of e){const t=r.targetId;if(!r.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,s)}}}(r.localStore,i))}async function fh(t,e){const n=Fr(t);if(!n.currentUser.isEqual(e)){Rr("SyncEngine","User change. New user:",e.toKey());const t=await Ic(n.localStore,e);n.currentUser=e,function(t,e){t.Ma.forEach((t=>{t.forEach((t=>{t.reject(new Br(Ur.CANCELLED,e))}))})),t.Ma.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await dh(n,t.us)}}function gh(t,e){const n=Fr(t),r=n.Ca.get(e);if(r&&r.pa)return yo().add(r.key);{let t=yo();const r=n.Sa.get(e);if(!r)return t;for(const e of r){const r=n.wa.get(e);t=t.unionWith(r.view.Ia)}return t}}function mh(t){const e=Fr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=th.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=nh.bind(null,e),e.ya.u_=Pu.bind(null,e.eventManager),e.ya.La=Vu.bind(null,e.eventManager),e}function ph(t){const e=Fr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=sh.bind(null,e),e}class yh{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Gc(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return Cc(this.persistence,new bc,t.initialUser,this.serializer)}createPersistence(t){return new vc(Ec.Hr,this.serializer)}createSharedClientState(t){return new Mc}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class vh{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>eh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=fh.bind(null,this.syncEngine),await Su(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Lu}createDatastore(t){const e=Gc(t.databaseInfo.databaseId),n=function(t){return new zc(t)}(t.databaseInfo);return function(t,e,n,r){return new Yc(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,s){return new $c(t,e,n,r,s)}(this.localStore,this.datastore,t.asyncQueue,(t=>eh(this.syncEngine,t,0)),Vc.D()?new Vc:new Pc)}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new Hu(t,e,n,r,s,i);return o&&(a.Oa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=Fr(t);Rr("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await tu(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class wh{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.qa(this.observer.next,t)}error(t){this.observer.error?this.qa(this.observer.error,t):Lr("Uncaught Error in snapshot listener:",t.toString())}Qa(){this.muted=!0}qa(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Eh{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Dr.UNAUTHENTICATED,this.clientId=Jr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Rr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Rr("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Br(Ur.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new jr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Du(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Th(t,e){t.asyncQueue.verifyOperationInProgress(),Rr("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Ic(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function _h(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Sh(t);Rr("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>bu(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>bu(e.remoteStore,n))),t._onlineComponents=e}function bh(t){return"FirebaseError"===t.name?t.code===Ur.FAILED_PRECONDITION||t.code===Ur.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}async function Sh(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Rr("FirestoreClient","Using user provided OfflineComponentProvider");try{await Th(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!bh(n))throw n;Or("Error using user provided cache. Falling back to memory cache: "+n),await Th(t,new yh)}}else Rr("FirestoreClient","Using default OfflineComponentProvider"),await Th(t,new yh);return t._offlineComponents}async function Ch(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Rr("FirestoreClient","Using user provided OnlineComponentProvider"),await _h(t,t._uninitializedComponentsProvider._online)):(Rr("FirestoreClient","Using default OnlineComponentProvider"),await _h(t,new vh))),t._onlineComponents}function Ih(t){return Ch(t).then((t=>t.syncEngine))}async function Ah(t){const e=await Ch(t),n=e.eventManager;return n.onListen=Wu.bind(null,e.syncEngine),n.onUnlisten=$u.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Xu.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Zu.bind(null,e.syncEngine),n}function Dh(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new jr;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new wh({next:i=>{e.enqueueAndForget((()=>Mu(t,o)));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new Br(Ur.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new Br(Ur.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:t=>s.reject(t)}),o=new ju(Gi(n.path),i,{includeMetadataChanges:!0,ta:!0});return Ou(t,o)}(await Ah(t),t.asyncQueue,e,n,r))),r.promise}function Nh(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const kh=new Map;function xh(t,e,n){if(!n)throw new Br(Ur.INVALID_ARGUMENT,"Function ".concat(t,"() cannot be called with an empty ").concat(e,"."))}function Rh(t){if(!os.isDocumentKey(t))throw new Br(Ur.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(t," has ").concat(t.length,"."))}function Lh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t="".concat(t.substring(0,20),"...")),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?"a custom ".concat(e," object"):"an object"}}return"function"==typeof t?"a function":Pr()}function Oh(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Br(Ur.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Lh(t);throw new Br(Ur.INVALID_ARGUMENT,"Expected type '".concat(e.name,"', but it was: ").concat(n))}}return t}class Mh{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Br(Ur.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Br(Ur.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Br(Ur.INVALID_ARGUMENT,"".concat(t," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Nh(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Br(Ur.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (must not be NaN)"));if(t.timeoutSeconds<5)throw new Br(Ur.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (minimum allowed value is 5)"));if(t.timeoutSeconds>30)throw new Br(Ur.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ph{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Mh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Br(Ur.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Br(Ur.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Mh(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new zr;switch(t.type){case"firstParty":return new Hr(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Br(Ur.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=kh.get(t);e&&(Rr("ComponentProvider","Removing Datastore"),kh.delete(t),e.terminate())}(this),Promise.resolve()}}class Vh{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Vh(this.firestore,t,this._query)}}class Fh{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Uh(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Fh(this.firestore,t,this._key)}}class Uh extends Vh{constructor(t,e,n){super(t,e,Gi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Fh(this.firestore,null,new os(t))}withConverter(t){return new Uh(this.firestore,t,this._path)}}function Bh(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];if(t=(0,a.Ku)(t),1===arguments.length&&(e=Jr.newId()),xh("doc","path",e),t instanceof Ph){const n=rs.fromString(e,...r);return Rh(n),new Fh(t,null,new os(n))}{if(!(t instanceof Fh||t instanceof Uh))throw new Br(Ur.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(rs.fromString(e,...r));return Rh(n),new Fh(t.firestore,t instanceof Uh?t.converter:null,new os(n))}}class jh{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Qc(this,"async_queue_retry"),this.cu=()=>{const t=Kc();t&&Rr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=Kc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.lu(),this.hu(t)}enterRestrictedMode(t){if(!this.iu){this.iu=!0,this.au=t||!1;const e=Kc();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.cu)}}enqueue(t){if(this.lu(),this.iu)return new Promise((()=>{}));const e=new jr;return this.hu((()=>this.iu&&this.au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.ru.push(t),this.Pu())))}async Pu(){if(0!==this.ru.length){try{await this.ru[0](),this.ru.shift(),this.jo.reset()}catch(t){if(!Es(t))throw t;Rr("AsyncQueue","Operation failed with retryable error: "+t)}this.ru.length>0&&this.jo.qo((()=>this.Pu()))}}hu(t){const e=this.nu.then((()=>(this._u=!0,t().catch((t=>{this.ou=t,this._u=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Lr("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this._u=!1,t))))));return this.nu=e,e}enqueueAfterDelay(t,e,n){this.lu(),this.uu.indexOf(t)>-1&&(e=0);const r=Au.createAndSchedule(this,t,e,n,(t=>this.Iu(t)));return this.su.push(r),r}lu(){this.ou&&Pr()}verifyOperationInProgress(){}async Tu(){let t;do{t=this.nu,await t}while(t!==this.nu)}Eu(t){for(const e of this.su)if(e.timerId===t)return!0;return!1}du(t){return this.Tu().then((()=>{this.su.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.su)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tu()}))}Au(t){this.uu.push(t)}Iu(t){const e=this.su.indexOf(t);this.su.splice(e,1)}}class qh extends Ph{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new jh,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Gh(this),this._firestoreClient.terminate()}}function zh(t,e){const n="object"==typeof t?t:(0,s.Sx)(),r="string"==typeof t?t:e||"(default)",i=(0,s.j6)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const t=(0,a.yU)("firestore");t&&function(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var s;const i=(t=Oh(t,Ph))._getSettings(),o="".concat(e,":").concat(n);if("firestore.googleapis.com"!==i.host&&i.host!==o&&Or("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Dr.MOCK_USER;else{e=(0,a.Fy)(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Br(Ur.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Dr(i)}t._authCredentials=new Kr(new qr(e,n))}}(i,...t)}return i}function Kh(t){return t._firestoreClient||Gh(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Gh(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new Ys(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Nh(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new Eh(t._authCredentials,t._appCheckCredentials,t._queue,i),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class Qh{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Qh(qs.fromBase64String(t))}catch(t){throw new Br(Ur.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Qh(qs.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Hh{constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(let r=0;r<e.length;++r)if(0===e[r].length)throw new Br(Ur.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new is(e)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Wh{constructor(t){this._methodName=t}}class Xh{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Br(Ur.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Br(Ur.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return $r(this._lat,t._lat)||$r(this._long,t._long)}}const Yh=/^__.*__$/;class Jh{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Go(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ko(t,this.data,e,this.fieldTransforms)}}function $h(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Pr()}}class Zh{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(t){return new Zh(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mu({path:n,gu:!1});return r.pu(t),r}yu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.mu({path:n,gu:!1});return r.Ru(),r}wu(t){return this.mu({path:void 0,gu:!0})}Su(t){return hl(t,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Ru(){if(this.path)for(let t=0;t<this.path.length;t++)this.pu(this.path.get(t))}pu(t){if(0===t.length)throw this.Su("Document fields must not be empty");if($h(this.Vu)&&Yh.test(t))throw this.Su('Document fields cannot begin and end with "__"')}}class tl{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Gc(t)}Cu(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Zh({Vu:t,methodName:e,Du:n,path:is.emptyPath(),gu:!1,bu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function el(t){const e=t._freezeSettings(),n=Gc(t._databaseId);return new tl(t._databaseId,!!e.ignoreUndefinedProperties,n)}function nl(t,e,n,r,s){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=t.Cu(i.merge||i.mergeFields?2:0,e,n,s);ol("Data must be an object, but it was:",o,r);const a=sl(r,o);let c,u;if(i.merge)c=new Bs(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=al(e,r,n);if(!o.contains(s))throw new Br(Ur.INVALID_ARGUMENT,"Field '".concat(s,"' is specified in your field mask but missing from your input data."));ll(t,s)||t.push(s)}c=new Bs(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new Jh(new fi(a),c,u)}function rl(t,e){if(il(t=(0,a.Ku)(t)))return ol("Unsupported field value:",e,t),sl(t,e);if(t instanceof Wh)return function(t,e){if(!$h(e.Vu))throw e.Su("".concat(t._methodName,"() can only be used with update() and set()"));if(!e.path)throw e.Su("".concat(t._methodName,"() is not currently supported inside arrays"));const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.gu&&4!==e.Vu)throw e.Su("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=rl(s,e.wu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,a.Ku)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return _o(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=ts.fromDate(t);return{timestampValue:Ia(e.serializer,n)}}if(t instanceof ts){const n=new ts(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ia(e.serializer,n)}}if(t instanceof Xh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Qh)return{bytesValue:Aa(e.serializer,t._byteString)};if(t instanceof Fh){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Su("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:ka(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Su("Unsupported field value: ".concat(Lh(t)))}(t,e)}function sl(t,e){const n={};return Os(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ls(t,((t,r)=>{const s=rl(r,e.fu(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function il(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ts||t instanceof Xh||t instanceof Qh||t instanceof Fh||t instanceof Wh)}function ol(t,e,n){if(!il(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Lh(n);throw"an object"===r?e.Su(t+" a custom object"):e.Su(t+" "+r)}}function al(t,e,n){if((e=(0,a.Ku)(e))instanceof Hh)return e._internalPath;if("string"==typeof e)return ul(t,e);throw hl("Field path arguments must be of type string or ",t,!1,void 0,n)}const cl=new RegExp("[~\\*/\\[\\]]");function ul(t,e,n){if(e.search(cl)>=0)throw hl("Invalid field path (".concat(e,"). Paths must not contain '~', '*', '/', '[', or ']'"),t,!1,void 0,n);try{return new Hh(...e.split("."))._internalPath}catch(E){throw hl("Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),t,!1,void 0,n)}}function hl(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a="Function ".concat(e,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=" in field ".concat(r)),o&&(c+=" in document ".concat(s)),c+=")"),new Br(Ur.INVALID_ARGUMENT,a+t+c)}function ll(t,e){return t.some((t=>t.isEqual(e)))}class dl{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Fh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new fl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(gl("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class fl extends dl{data(){return super.data()}}function gl(t,e){return"string"==typeof e?ul(t,e):e instanceof Hh?e._internalPath:e._delegate._internalPath}class ml{convertValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Zs(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Gs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Qs(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Pr()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return Ls(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Xh(Gs(t.latitude),Gs(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ws(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Xs(t));default:return null}}convertTimestamp(t){const e=Ks(t);return new ts(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=rs.fromString(t);Vr($a(n));const r=new Js(n.get(1),n.get(3)),s=new os(n.popFirst(5));return r.isEqual(e)||Lr("Document ".concat(s," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(e.projectId,"/").concat(e.database,") instead.")),s}}function pl(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class yl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class vl extends dl{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const e=new wl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(gl("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class wl extends vl{data(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(t)}}function El(t){t=Oh(t,Fh);const e=Oh(t.firestore,qh);return Dh(Kh(e),t._key).then((n=>Sl(e,t,n)))}class Tl extends ml{constructor(t){super(),this.firestore=t}convertBytes(t){return new Qh(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Fh(this.firestore,null,e)}}function _l(t,e,n){t=Oh(t,Fh);const r=Oh(t.firestore,qh),s=pl(t.converter,e,n);return bl(r,[nl(el(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,Po.none())])}function bl(t,e){return function(t,e){const n=new jr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=ph(t);try{const t=await function(t,e){const n=Fr(t),r=ts.now(),s=e.reduce(((t,e)=>t.add(e.key)),yo());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=ao(),c=yo();return n.os.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=qo(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new Go(t.key,e,gi(e.value.mapValue),Po.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:ho(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Fa[t.currentUser.toKey()];r||(r=new Ms($r)),r=r.insert(e,n),t.Fa[t.currentUser.toKey()]=r}(r,t.batchId,n),await dh(r,t.changes),await gu(r.remoteStore)}catch(t){const e=Du(t,"Failed to persist write");n.reject(e)}}(await Ih(t),e,n))),n.promise}(Kh(t),e)}function Sl(t,e,n){const r=n.docs.get(e._key),s=new Tl(t);return new vl(t,s,e._key,r,new yl(n.hasPendingWrites,n.fromCache),e.converter)}new WeakMap;!function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(t){Nr=t}(s.MF),(0,s.om)(new i.uA("firestore",((t,n)=>{let{instanceIdentifier:r,options:s}=n;const i=t.getProvider("app").getImmediate(),o=new qh(new Gr(t.getProvider("auth-internal")),new Xr(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Br(Ur.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Js(t.options.projectId,e)}(i,r),i);return s=Object.assign({useFetchStreams:e},s),o._setSettings(s),o}),"PUBLIC").setMultipleInstances(!0)),(0,s.KO)(Ar,"4.6.0",t),(0,s.KO)(Ar,"4.6.0","esm2017")}()}}]);
//# sourceMappingURL=179.fe345f5f.chunk.js.map